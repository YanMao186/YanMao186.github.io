<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Hibernate总结 | 编程是一门艺术</title>
  
  

  
  <link rel="alternate" href="/atom.xml" title="编程是一门艺术">
  

  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <!-- meta -->
  

  <!-- link -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.6.3/css/all.min.css">
  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/css/style.css">
  

  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>

  
  
</head>

<style>
#canvas {
  position: fixed;
  right: 0px;
  bottom: 0px;
  min-width: 100%;
  min-height: 100%;
  height: auto;
  width: auto;
  z-index: -1;
}
</style>
<body>
  
  
  <div class="cover-wrapper">
    <cover class='cover post half'>
      
        
  <h1 class='title'>Hello World</h1>


<div class='menu navgation'>
  <ul class='h-list'>
    
      
        <li>
          <a class="nav home" href="/"
            
            
            id="home">
            <i class='fas fa-rss fa-fw'></i>&nbsp;博文
          </a>
        </li>
      
        <li>
          <a class="nav home" href="https://github.com/YanMao186"
            
            
            id="https:github.comYanMao186">
            <i class='fab fa-github fa-fw'></i>&nbsp;github
          </a>
        </li>
      
        <li>
          <a class="nav home" href="/about/"
            
              rel="nofollow"
            
            
            id="about">
            <i class='fas fa-info-circle fa-fw'></i>&nbsp;关于
          </a>
        </li>
      
    
  </ul>
</div>

      
    </cover>
    <header class="l_header pure">
  <div id="loading-bar-wrapper">
    <div id="loading-bar" class="pure"></div>
  </div>

	<div class='wrapper'>
		<div class="nav-main container container--flex">
      <a class="logo flat-box" href='/' >
        
          编程是一门艺术
        
      </a>
			<div class='menu navgation'>
				<ul class='h-list'>
          
  					
  						<li>
								<a class="nav flat-box" href="/"
                  
                  
                  id="home">
									<i class='fas fa-grin fa-fw'></i>&nbsp;示例
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blog/categories/"
                  
                    rel="nofollow"
                  
                  
                  id="blogcategories">
									<i class='fas fa-folder-open fa-fw'></i>&nbsp;分类
								</a>
							</li>
      			
  						<li>
								<a class="nav flat-box" href="/blog/tags/"
                  
                    rel="nofollow"
                  
                  
                  id="blogtags">
									<i class='fas fa-hashtag fa-fw'></i>&nbsp;标签
								</a>
							</li>
      			
      		
				</ul>
			</div>

			
			<ul class='switcher h-list'>
				
				<li class='s-menu'><a class="fas fa-bars fa-fw" href='javascript:void(0)'></a></li>
			</ul>
		</div>

		<div class='nav-sub container container--flex'>
			<a class="logo flat-box"></a>
			<ul class='switcher h-list'>
				<li class='s-comment'><a class="flat-btn fas fa-comments fa-fw" href='javascript:void(0)'></a></li>
        
          <li class='s-toc'><a class="flat-btn fas fa-list fa-fw" href='javascript:void(0)'></a></li>
        
			</ul>
		</div>
	</div>
</header>
	<aside class="menu-phone">
    <header>
		<nav class="menu navgation">
      <ul>
        
          
            <li>
							<a class="nav flat-box" href="/"
                
                
                id="home">
								<i class='fas fa-clock fa-fw'></i>&nbsp;近期文章
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="https://github.com/YanMao186"
                
                
                id="https:github.comYanMao186">
								<i class='fab fa-github fa-fw'></i>&nbsp;github
							</a>
            </li>
          
            <li>
							<a class="nav flat-box" href="/about/"
                
                  rel="nofollow"
                
                
                id="about">
								<i class='fas fa-info-circle fa-fw'></i>&nbsp;关于小站
							</a>
            </li>
          
       
      </ul>
		</nav>
    </header>
	</aside>
<script>setLoadingBarProgress(40);</script>

  </div>


  <div class="l_body">
    <div class='body-wrapper'>
      <div class='l_main'>
  

  
    <article id="post" class="post white-box article-type-post" itemscope itemprop="blogPost">
      


  <section class='meta'>
    
    
    <div class="meta" id="header-meta">
      
        
  
    <h1 class="title">
      <a href="/2019/07/10/Hibernate总结/">
        Hibernate总结
      </a>
    </h1>
  


      
      <div class='new-meta-box'>
        
          
        
          
            
  <div class='new-meta-item author'>
    <a href="http://yoursite.com" rel="nofollow">
      
        <i class="fas fa-user" aria-hidden="true"></i>
      
      <p>Yan Mao</p>
    </a>
  </div>


          
        
          
            <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
    <p>2019-07-10</p>
  </a>
</div>

          
        
          
            
  
  <div class='new-meta-item category'>
    <a href='/categories/java/' rel="nofollow">
      <i class="fas fa-folder-open" aria-hidden="true"></i>
      <p>java</p>
    </a>
  </div>


          
        
          
            
  
    <div class="new-meta-item browse busuanzi">
      <a class='notlink'>
        <i class="fas fa-eye" aria-hidden="true"></i>
        <p>
          <span id="busuanzi_value_page_pv">
            <i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i>
          </span>
        </p>
      </a>
    </div>
  


          
        
          
            

          
        
      </div>
      
        <hr>
      
    </div>
  </section>


      <section class="article typo">
        <div class="article-entry" itemprop="articleBody">
          <h2 id="Hibernate笔记"><a href="#Hibernate笔记" class="headerlink" title="Hibernate笔记"></a>Hibernate笔记</h2><h3 id="day01"><a href="#day01" class="headerlink" title="day01"></a>day01</h3><h3 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h3><h4 id="1-什么是Hibernate"><a href="#1-什么是Hibernate" class="headerlink" title="1. 什么是Hibernate"></a>1. 什么是Hibernate</h4><ul>
<li><p><code>Hibernate是一个开源的ORM(Object Relational Mapping对象关系映射)框架,对JDBC进行了轻量级的对象封装,使我们开发人员可以使用面向对象的编程思想来操作数据库.</code></p>
<p><img src="/2019/07/10/Hibernate总结/ORM%E5%8E%9F%E7%90%86.png" alt="ORM原理"></p>
</li>
</ul>
<h4 id="2-优势"><a href="#2-优势" class="headerlink" title="2. 优势"></a>2. 优势</h4><ul>
<li>对JDBC访问数据库的代码进行了轻量级封装,大大简化了数据访问层繁琐的重复性代码,减少内存消耗,加快运行效率.</li>
<li>Hibernate是一款基于JDBC的主流持久化框架,是一个优秀的ORM实现,很大程度的简化了DAO(Data Access Object,数据访问对象)层编码工作.</li>
<li>性能好,映射的灵活性很出色,它支持关系型数据库,从1对1到多对多的各种复杂关系.</li>
<li>可拓展性强,由于源代码的开源以及API的开放,当本身功能不够用时,可以自行编码进行拓展.</li>
</ul>
<h4 id="3-入门"><a href="#3-入门" class="headerlink" title="3.入门"></a>3.入门</h4><h5 id="1-首先看一下项目的整体目录结构"><a href="#1-首先看一下项目的整体目录结构" class="headerlink" title="1.首先看一下项目的整体目录结构"></a>1.首先看一下项目的整体目录结构</h5><p><img src="/2019/07/10/Hibernate总结/%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84.png" alt="目录结构"></p>
<h5 id="2-项目需要的jar包"><a href="#2-项目需要的jar包" class="headerlink" title="2.项目需要的jar包"></a>2.项目需要的jar包</h5><p><img src="/2019/07/10/Hibernate总结/lib%E7%9B%AE%E5%BD%95.png" alt="lib目录"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.ym.hibernate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: hibernatedemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Yan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2019-05-16 13:04</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="comment">//声明当前类为实体类</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="comment">//指定当前类与数据库表的映射关系</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"cst_customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"><span class="comment">//用于指定主键</span></span><br><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="comment">//用于指定主键的生成策略,GenerationType.IDENTITY为mysql默认的</span></span><br><span class="line">    <span class="comment">//当使用xml建立实体类与数据库表的关系时,不需要以上所有的注解</span></span><br><span class="line"><span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Long cust_id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String cust_name;</span><br><span class="line">    <span class="keyword">private</span> String cust_source;</span><br><span class="line">    <span class="keyword">private</span> String cust_industry;</span><br><span class="line">    <span class="keyword">private</span> String cust_linkman;</span><br><span class="line">    <span class="keyword">private</span> String cust_phone;</span><br><span class="line">    <span class="keyword">private</span> String cust_mobile;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getCust_id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cust_id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_id</span><span class="params">(Long cust_id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cust_id = cust_id;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCust_name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cust_name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_name</span><span class="params">(String cust_name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cust_name = cust_name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCust_source</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cust_source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_source</span><span class="params">(String cust_source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cust_source = cust_source;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCust_industry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cust_industry;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_industry</span><span class="params">(String cust_industry)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cust_industry = cust_industry;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCust_linkman</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cust_linkman;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_linkman</span><span class="params">(String cust_linkman)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cust_linkman = cust_linkman;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCust_phone</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cust_phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_phone</span><span class="params">(String cust_phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cust_phone = cust_phone;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCust_mobile</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cust_mobile;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCust_mobile</span><span class="params">(String cust_mobile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cust_mobile = cust_mobile;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Customer&#123;"</span> +</span><br><span class="line">                <span class="string">"cust_id="</span> + cust_id +</span><br><span class="line">                <span class="string">", cust_name='"</span> + cust_name + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cust_source='"</span> + cust_source + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cust_industry='"</span> + cust_industry + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cust_linkman='"</span> + cust_linkman + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cust_phone='"</span> + cust_phone + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">", cust_mobile='"</span> + cust_mobile + <span class="string">'\''</span> +</span><br><span class="line">                <span class="string">'&#125;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-创建实体类与数据库的映射关系-Customer-hbm-xml"><a href="#4-创建实体类与数据库的映射关系-Customer-hbm-xml" class="headerlink" title="4.创建实体类与数据库的映射关系(Customer.hbm.xml)"></a>4.创建实体类与数据库的映射关系(Customer.hbm.xml)</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置表与实体对象的关系 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- package属性:填写一个包名.在元素内部凡是需要书写完整类名的属性,可以直接写简答类名了. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.ym.hibernate"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        class元素: 配置实体与表的对应关系的</span></span><br><span class="line"><span class="comment">            name: 完整类名</span></span><br><span class="line"><span class="comment">            table:数据库表名</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- id元素:配置主键映射的属性</span></span><br><span class="line"><span class="comment">                name: 填写主键对应属性名</span></span><br><span class="line"><span class="comment">                column(可选): 填写表中的主键列名.默认值:列名会默认使用属性名</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span>  &gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- generator:主键生成策略 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property元素:除id之外的普通属性映射</span></span><br><span class="line"><span class="comment">                name: 填写属性名</span></span><br><span class="line"><span class="comment">                column(可选): 填写列名</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span> &gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  &lt;column name="cust_name" sql-type="varchar" &gt;&lt;/column&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_linkman"</span> <span class="attr">column</span>=<span class="string">"cust_linkman"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="5-创建hibernate的核心配置文件-位于src根目录-hibernate-cfg-xml"><a href="#5-创建hibernate的核心配置文件-位于src根目录-hibernate-cfg-xml" class="headerlink" title="5.创建hibernate的核心配置文件,位于src根目录(hibernate.cfg.xml)"></a>5.创建hibernate的核心配置文件,位于src根目录(hibernate.cfg.xml)</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Configuration DTD//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name="connection.url"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name="connection.driver_class"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name="connection.username"/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name="connection.password"/&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- DB schema will be updated if needed --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库驱动  必须配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库url 必须配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接用户名 必须配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接密码 必须配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库方言  必须配置</span></span><br><span class="line"><span class="comment">            不同的数据库中,sql语法略有区别. 指定方言可以让hibernate框架在生成sql语句时.针对数据库的方言生成.</span></span><br><span class="line"><span class="comment">            sql99标准: DDL 定义语言  库表的增删改查</span></span><br><span class="line"><span class="comment">                      DCL 控制语言  事务 权限</span></span><br><span class="line"><span class="comment">                      DML 操纵语言  增删改查</span></span><br><span class="line"><span class="comment">            注意: MYSQL在选择方言时,请选择最短的方言.</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--不知道为啥必须写两个dialect数据库表才会创建成功--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- #hibernate.show_sql true</span></span><br><span class="line"><span class="comment">             #hibernate.format_sql true</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 将hibernate生成的sql语句打印到控制台 可选配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 将hibernate生成的sql语句格式化(语法缩进) 可选配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        ## auto schema export  自动导出表结构. 自动建表    可选配置</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto create		自动建表.每次框架运行都会创建新的表.以前表将会被覆盖,表数据会丢失.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto create-drop 自动建表.每次框架运行结束都会将所有表删除.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto update(推荐使用) 自动生成表.如果已经存在不会再生成.如果表有变动.自动更新表(不会删除任何数据).</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto validate	校验.不自动生成表.每次启动会校验数据库中表是否正确.校验失败.</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当使用xml建立与实体类的映射时使用此配置--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapping resource="./com/ym/hibernate/Customer.hbm.xml" /&gt;--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">class</span>=<span class="string">"com.ym.hibernate.Customer"</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当在实体类上使用注解时使用此配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="6-测试类"><a href="#6-测试类" class="headerlink" title="6.测试类"></a>6.测试类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.ym.hibernate.Customer;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.SessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.Transaction;</span><br><span class="line"><span class="keyword">import</span> org.hibernate.cfg.Configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: hibernatedemo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: Mr.Yan</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2019-05-16 13:11</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1.加载配置文件</span></span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure(<span class="string">"hibernate.cfg.xml"</span>);</span><br><span class="line">        <span class="comment">//hibernate.cfg.xml默认位于src根路径下</span></span><br><span class="line">        <span class="comment">//2.创建一个SessionFactory</span></span><br><span class="line">        SessionFactory sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">        <span class="comment">//3.创建Session对象</span></span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        <span class="comment">//4.开启事务</span></span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        <span class="comment">//5.执行相关操作</span></span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCust_name(<span class="string">"alibaba"</span>);</span><br><span class="line">        customer.setCust_phone(<span class="string">"12345678900"</span>);</span><br><span class="line">        session.save(customer);</span><br><span class="line">        <span class="comment">//6.提交事务</span></span><br><span class="line">        transaction.commit();</span><br><span class="line">        <span class="comment">//7.释放资源</span></span><br><span class="line">        session.close();</span><br><span class="line">        sessionFactory.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-常用API"><a href="#4-常用API" class="headerlink" title="4.常用API"></a>4.常用API</h4><h5 id="1-Configuration"><a href="#1-Configuration" class="headerlink" title="1. Configuration"></a>1. Configuration</h5><ul>
<li>用于配置加载类,用于加载主配置文件,orm元数据加载</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span></span>&#123;</span><br><span class="line">	<span class="comment">//1 创建,调用空参构造</span></span><br><span class="line">	Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">	<span class="comment">//2 读取指定主配置文件 =&gt; 空参加载方法,加载src下的hibernate.cfg.xml文件</span></span><br><span class="line">	conf.configure();</span><br><span class="line">	<span class="comment">//3 读取指定orm元数据(扩展),如果主配置中已经引入映射配置.不需要手动加载</span></span><br><span class="line">	<span class="comment">//conf.addResource(resourceName);</span></span><br><span class="line">	<span class="comment">//conf.addClass(persistentClass);</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">//4 根据配置信息,创建 SessionFactory对象</span></span><br><span class="line">	SessionFactory sf = conf.buildSessionFactory();</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-SessionFactory"><a href="#2-SessionFactory" class="headerlink" title="2.SessionFactory"></a>2.SessionFactory</h5><ul>
<li><p>用于创建操作数据库核心对象session对象的工厂(创建session对象)</p>
</li>
<li><p>sessionfactory负责保存和使用所有配置信息,消耗内存资源非常大</p>
</li>
<li><p>sessionfactory属于线程安全的对象设计</p>
</li>
<li><p>保证在web项目中,只创建一个sessionFactory</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 创建,调用空参构造</span></span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration();</span><br><span class="line">		<span class="comment">//2 读取指定主配置文件 =&gt; 空参加载方法,加载src下的hibernate.cfg.xml文件</span></span><br><span class="line">		conf.configure();</span><br><span class="line">		<span class="comment">//3 读取指定orm元数据(扩展),如果主配置中已经引入映射配置.不需要手动加载</span></span><br><span class="line">		<span class="comment">//conf.addResource(resourceName);</span></span><br><span class="line">		<span class="comment">//conf.addClass(persistentClass);</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4 根据配置信息,创建 SessionFactory对象</span></span><br><span class="line">		SessionFactory sf = conf.buildSessionFactory();</span><br><span class="line">		<span class="comment">//5 获得session</span></span><br><span class="line">		<span class="comment">//打开一个新的session对象</span></span><br><span class="line">		Session session = sf.openSession();</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h5 id="3-session"><a href="#3-session" class="headerlink" title="3.session"></a>3.session</h5><ul>
<li>表达hibernate框架与数据库之间的连接(会话),类似于JDBC中的connection对象,还可以完成数据库中数据的增删改查操作,session是hibernate操作数据库的核心对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//事务操作</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 创建,调用空参构造</span></span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//2 根据配置信息,创建 SessionFactory对象</span></span><br><span class="line">		SessionFactory sf = conf.buildSessionFactory();</span><br><span class="line">		<span class="comment">//3 获得session</span></span><br><span class="line">		Session session = sf.openSession();</span><br><span class="line">		<span class="comment">//4 session获得操作事务的Transaction对象</span></span><br><span class="line">		<span class="comment">//获得操作事务的tx对象</span></span><br><span class="line">		<span class="comment">//Transaction tx = session.getTransaction();</span></span><br><span class="line">		<span class="comment">//开启事务并获得操作事务的tx对象(建议使用)</span></span><br><span class="line">		Transaction tx2 = session.beginTransaction();</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		tx2.commit();<span class="comment">//提交事务</span></span><br><span class="line">		tx2.rollback();<span class="comment">//回滚事务</span></span><br><span class="line">		session.close();<span class="comment">//释放资源</span></span><br><span class="line">		sf.close();<span class="comment">//释放资源</span></span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//session的新增</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun2</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 创建,调用空参构造</span></span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//2 根据配置信息,创建 SessionFactory对象</span></span><br><span class="line">		SessionFactory sf = conf.buildSessionFactory();</span><br><span class="line">		<span class="comment">//3 获得session</span></span><br><span class="line">		Session session = sf.openSession();</span><br><span class="line">		<span class="comment">//4 session获得操作事务的Transaction对象</span></span><br><span class="line">		<span class="comment">//获得操作事务的tx对象</span></span><br><span class="line">		<span class="comment">//Transaction tx = session.getTransaction();</span></span><br><span class="line">		<span class="comment">//开启事务并获得操作事务的tx对象(建议使用)</span></span><br><span class="line">		Transaction tx2 = session.beginTransaction();</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		Customer c = <span class="keyword">new</span> Customer();</span><br><span class="line">		c.setCust_name(<span class="string">"xxxx"</span>);</span><br><span class="line">		</span><br><span class="line">		session.save(c);</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		tx2.commit();<span class="comment">//提交事务</span></span><br><span class="line">		session.close();<span class="comment">//释放资源</span></span><br><span class="line">		sf.close();<span class="comment">//释放资源</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//session的查询</span></span><br><span class="line">	<span class="comment">//查询id为1的customer对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun3</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 创建,调用空参构造</span></span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//2 根据配置信息,创建 SessionFactory对象</span></span><br><span class="line">		SessionFactory sf = conf.buildSessionFactory();</span><br><span class="line">		<span class="comment">//3 获得session</span></span><br><span class="line">		Session session = sf.openSession();</span><br><span class="line">		<span class="comment">//4 session获得操作事务的Transaction对象</span></span><br><span class="line">		<span class="comment">//获得操作事务的tx对象</span></span><br><span class="line">		<span class="comment">//Transaction tx = session.getTransaction();</span></span><br><span class="line">		<span class="comment">//开启事务并获得操作事务的tx对象(建议使用)</span></span><br><span class="line">		Transaction tx2 = session.beginTransaction();</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		</span><br><span class="line">		Customer customer = session.get(Customer.class, <span class="number">1l</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(customer);</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		tx2.commit();<span class="comment">//提交事务</span></span><br><span class="line">		session.close();<span class="comment">//释放资源</span></span><br><span class="line">		sf.close();<span class="comment">//释放资源</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//session的修改</span></span><br><span class="line">	<span class="comment">//修改id为1的customer对象的name属性为黑马程序员</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun4</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 创建,调用空参构造</span></span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//2 根据配置信息,创建 SessionFactory对象</span></span><br><span class="line">		SessionFactory sf = conf.buildSessionFactory();</span><br><span class="line">		<span class="comment">//3 获得session</span></span><br><span class="line">		Session session = sf.openSession();</span><br><span class="line">		<span class="comment">//4 session获得操作事务的Transaction对象</span></span><br><span class="line">		<span class="comment">//获得操作事务的tx对象</span></span><br><span class="line">		<span class="comment">//Transaction tx = session.getTransaction();</span></span><br><span class="line">		<span class="comment">//开启事务并获得操作事务的tx对象(建议使用)</span></span><br><span class="line">		Transaction tx2 = session.beginTransaction();</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		<span class="comment">//1 获得要修改的对象</span></span><br><span class="line">		Customer c = session.get(Customer.class, <span class="number">1l</span>);</span><br><span class="line">		<span class="comment">//2 修改</span></span><br><span class="line">		c.setCust_name(<span class="string">"xxxxxxx"</span>);</span><br><span class="line">		<span class="comment">//3 执行update</span></span><br><span class="line">		session.update(c);</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		tx2.commit();<span class="comment">//提交事务</span></span><br><span class="line">		session.close();<span class="comment">//释放资源</span></span><br><span class="line">		sf.close();<span class="comment">//释放资源</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//session的删除</span></span><br><span class="line">	<span class="comment">//删除id为1的customer对象</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun5</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 创建,调用空参构造</span></span><br><span class="line">		Configuration conf = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">		<span class="comment">//2 根据配置信息,创建 SessionFactory对象</span></span><br><span class="line">		SessionFactory sf = conf.buildSessionFactory();</span><br><span class="line">		<span class="comment">//3 获得session</span></span><br><span class="line">		Session session = sf.openSession();</span><br><span class="line">		<span class="comment">//4 session获得操作事务的Transaction对象</span></span><br><span class="line">		<span class="comment">//获得操作事务的tx对象</span></span><br><span class="line">		Transaction tx = session.getTransaction();</span><br><span class="line">		tx.begin();</span><br><span class="line">		<span class="comment">//开启事务并获得操作事务的tx对象(建议使用)</span></span><br><span class="line">		Transaction tx2 = session.beginTransaction();</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		<span class="comment">//1 获得要修改的对象</span></span><br><span class="line">		Customer c = session.get(Customer.class, <span class="number">1l</span>);</span><br><span class="line">		<span class="comment">//2 调用delete删除对象</span></span><br><span class="line">		session.delete(c);</span><br><span class="line">		<span class="comment">//----------------------------------------------</span></span><br><span class="line">		tx2.commit();<span class="comment">//提交事务</span></span><br><span class="line">		session.close();<span class="comment">//释放资源</span></span><br><span class="line">		sf.close();<span class="comment">//释放资源</span></span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-Transaction"><a href="#4-Transaction" class="headerlink" title="4.Transaction"></a>4.Transaction</h5><ul>
<li><p>Transaction是一个可选的API,可以不选择这个接口.</p>
</li>
<li><p>主要用于管理事务,是Hibernate的数据库事务接口,并对底层的事务接口进行了封装,Transaction接口的事务对象是通过session对象开启的</p>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Transaction transaction = session.beginTransaction();</span><br></pre></td></tr></table></figure>
</li>
<li><p>transaction接口,对于事务管理的常用方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">transaction.commit();			<span class="comment">//提交相关联的session实例</span></span><br><span class="line">transaction.rollback();			<span class="comment">//撤销事务操作</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>==Session==</strong>执行完数据库操作后,要使用<strong>==Transaction==</strong>接口的<strong>==commit()==</strong>方法进行事务提交,才能真正的将数据操作同步到数据库中,发生异常时,需要使用==<strong>rollback()</strong>==方法进行事务回滚,以避免数据发生错误,因此,在持久化操作后,必须调用<strong>==Transaction==</strong>接口的<strong>==commit()==</strong>方法和<strong>==rollback()==</strong>方法,如果没有开启事务,那么每个<strong>==Session==</strong>的操作,都相当于一个独立的操作.</p>
</li>
</ul>
<h2 id="Hibernate-day02"><a href="#Hibernate-day02" class="headerlink" title="Hibernate day02"></a>Hibernate day02</h2><h3 id="一-Hibernate实体类注意事项"><a href="#一-Hibernate实体类注意事项" class="headerlink" title="一.Hibernate实体类注意事项"></a>一.Hibernate实体类注意事项</h3><ol>
<li><strong>实体类必须提供无参构造</strong>(因为Hibernate的底层需要使用反射生成类的实例)</li>
<li><strong>持久化类的属性需要私有,对私有的属性提供公共的get和set方法</strong>(因为Hibernate底层会将查询到的数据进行封装)</li>
<li><strong>持久化类的属性要尽量使用包装类型</strong>(因为包装类型和基本数据类型的默认值不同,包装类的类型语义描述更清晰而基本类型不容易描述)</li>
<li><strong>持久化类要有一个唯一标识OID与表的主键对应</strong>(因为在hibernate中需要通过这个唯一标识OID区分在内存中是否是同一个持久化类,在java中通过地址区分是否是同一个对象的,在关系型数据库的表中是通过主键区分是否是同一条记录,那么Hibernate就是通过这个OID来进行区分的,Hibernate是不允许在内存中出现两个OID相同的持久化对象的)</li>
<li><strong>持久化类尽量不要使用final进行修饰</strong>(因为Hibernate中有延迟加载的机制,这个机制中会产生代理对象,Hibernate产生代理对象使用的是字节码的增强技术完成的,其实就是产生了当前类的一个子类对象实现的,如果使用了final修饰持久化类,那么就不能产生子类,从而就不会产生代理对象,那么hibernate的延迟加载策略就会失效)</li>
</ol>
<h3 id="二-主键生成策略"><a href="#二-主键生成策略" class="headerlink" title="二.主键生成策略"></a>二.主键生成策略</h3><ol>
<li><p><strong>主键的类型</strong></p>
<ul>
<li><code>自然主键:把具有业务含义的字段作为主键,称之为自然主键,如在用户表中将name字段作为主键,其前提条件必须是:&quot;每一个用户姓名不允许为null,不允许重名,并且不允许修改用户姓名&quot;</code></li>
<li><code>代理主键:把不具备业务含义的字段作为主键,称之为代理主键,该字段一般取名为ID,通常为整数类型,因为整数类型比字符串类型要节省更多的数据空间,开发中常用</code></li>
</ul>
</li>
<li><p><strong>主键生成策略</strong></p>
<p> <img src="/2019/07/10/Hibernate总结/1558060355939.png" alt="1558060355939"></p>
<table>
<thead>
<tr>
<th align="center">主键类型</th>
<th align="center">名称</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">代理主键</td>
<td align="center">increment</td>
<td align="center">用于long,short,或int类型,由Hibernate自动以递增的方式生成唯一标识符,每次增量为1,只有当没有其它进程向同一张表中插入数据时才可以使用,不能用于集群环境下</td>
</tr>
<tr>
<td align="center">代理主键</td>
<td align="center">identity</td>
<td align="center">采用底层数据库本身提供的主键生成标识符,条件是数据库支持自动增长数据类型,在DB2,MySQL,MS,SQL,Server,Sybase和HypersonicSQL数据库中可以使用该生成器,该生成器要求在数据库中把主键定义成为自增长类型,适用于代理主键</td>
</tr>
<tr>
<td align="center">代理主键</td>
<td align="center">sequence</td>
<td align="center">Hibernate根据底层数据库序列生成标识符,条件是数据库支持序列,适用于代理主键</td>
</tr>
<tr>
<td align="center">代理主键</td>
<td align="center">native</td>
<td align="center">根据底层数据库对自动生成标识符的能力来选择identity,sequence,hilo三种生成器中的一种,适合跨数据库平台开发,适用于代理主键</td>
</tr>
<tr>
<td align="center">代理主键</td>
<td align="center">uuid</td>
<td align="center">产生随机字符串作为主键,主键类型必须为String类型,适用于代理主键</td>
</tr>
<tr>
<td align="center">自然主键</td>
<td align="center">assigned</td>
<td align="center">由java程序负责生成标识符,如果不指定id元素的generator属性,则默认使用该主键生成策略,适用于自然主键</td>
</tr>
</tbody></table>
</li>
</ol>
<h3 id="三-对象状态"><a href="#三-对象状态" class="headerlink" title="三.对象状态"></a>三.对象状态</h3><ol>
<li><p><strong>对象分为三种状态</strong></p>
<ul>
<li><code>瞬时状态:没有id,没有与session关联</code></li>
<li><code>持久化状态:有id,与session有关联</code></li>
<li><code>游离|托管状态:有id,没有与session关联</code></li>
</ul>
</li>
<li><p><strong>三种状态代码演示</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">        SessionFactory sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer(); <span class="comment">//没有id,没有与session关联,瞬时状态</span></span><br><span class="line">        customer.setCust_name(<span class="string">"Lenovo"</span>); <span class="comment">//瞬时状态</span></span><br><span class="line">        session.save(customer);    <span class="comment">//持久化状态,有id,有关联</span></span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();   <span class="comment">//游离|托管,有id,没有与session关联</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>customer对象由new关键字创建,此时还未与session进行关联,它的状态称为瞬时状态,在执行了session.save(customer)后,customer对象纳入session的管理范围,此时的customer对象变成了持久态对象,此时的session的事务还没有被提交;程序执行完commit()操作并关闭了session后,customer对象与session的关联被关闭,此时customer对象就变成了托管态.</code></p>
</li>
<li><p><strong>持久化对象三种状态转换图解</strong></p>
</li>
</ol>
<p><img src="/2019/07/10/Hibernate总结/1558062569476.png" alt="1558062569476"></p>
<ol start="4">
<li><p><strong>瞬时状态转换到其他状态</strong></p>
<ul>
<li><p><code>瞬时状态转换为持久态:执行session的save()或saveOrUpdate()方法</code></p>
</li>
<li><p><code>瞬时状态转换为托管态:为瞬时态对象设置持久化标识OID</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Customer customer = <span class="keyword">new</span> Customer(); <span class="comment">//瞬时态</span></span><br><span class="line">customer.setCust_id(<span class="number">1</span>);				<span class="comment">//托管态</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><strong>持久态对象转换到其他对象</strong></p>
<ul>
<li><code>持久态转换为瞬时状态:执行session的delete()方法,需要注意的是被删除的持久化对象,不建议再次使用</code></li>
<li><code>持久态转换为托管态:执行session的evict(),close()或clear()方法,evict()用于清除一级缓存中某一个对象;close()用于关闭session,清除一级缓存;clear()用于清除一级缓存的所有对象.</code></li>
</ul>
</li>
<li><p><strong>托管态的对象转换到其他对象</strong></p>
<ul>
<li><code>托管态转换为持久态:执行Session的update(),saveOrUpdate()或lock()方法</code></li>
<li><code>托管态转换为瞬时态:将托管态对象的持久化标识OID设置为null.</code></li>
</ul>
</li>
<li><p><strong>持久态对象可以自动更新数据库</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">        SessionFactory sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line"><span class="comment">//获得持久态对象</span></span><br><span class="line">        Customer customer = session.get(Customer.class, <span class="number">2L</span>);</span><br><span class="line">        customer.setCust_name(<span class="string">"sum"</span>);</span><br><span class="line">     <span class="comment">//不需要调用update方法就可以进行更新,依赖于Hibernate的一级缓存</span></span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();   <span class="comment">//游离|托管,有id,没有关联</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="四-Hibernate的缓存"><a href="#四-Hibernate的缓存" class="headerlink" title="四.Hibernate的缓存"></a>四.Hibernate的缓存</h3><ul>
<li><code>Hibernate的缓存分为一级缓存和二级缓存,这两级缓存都位于持久层,存储的都是数据库数据的备份,其中第一级缓存为Hibernate的内置缓存,不能被卸载.</code></li>
</ul>
<h5 id="Hibernate的一级缓存"><a href="#Hibernate的一级缓存" class="headerlink" title="Hibernate的一级缓存"></a>Hibernate的一级缓存</h5><ul>
<li><p>一级缓存就是指Session缓存,Session缓存的是一块内存空间,用来存放相互管理的java对象,在hibernate查询对象的时候,首先会使用对象属性的OID值在Hibernate的一级缓存中查找,如果匹配到OID的对象,就直接将该对象从一级缓存中取出使用,不会再查询数据库,如果没有找到相同的OID值得对象,则会去数据库查找相应的数据,当数据库中查询到所需数据时,该数据信息也会放置到一级缓存中,<strong>Hibernate的一级缓存的作用就是减少对数据库的访问次数</strong></p>
</li>
<li><p>在session接口的实现中包含一系列的java集合,这些java集合构成了session缓存,只要session实例没有结束生命2周期,存放在他缓存中的对象也就不会结束生命周期,<strong>一级缓存也被称之为是session基本的缓存</strong></p>
</li>
<li><p><strong>一级缓存的特点</strong></p>
<ul>
<li>当应用程序调用session接口的save(),update(),saveOrUpdate()时,如果session缓存中没有相应的对象,Hibernate就会自动把从数据库中查询到的相应信息加入到一级缓存中.</li>
<li>当调用session接口的load(),get()方法,以及Query接口的list(),iterator()方法时,会判断缓存中是否存在该对象,有则返回,不会查询数据库,如果缓存中没有要查询对象,再去数据库中查询对应对象,并添加到一级缓存中</li>
<li>当调用session的close()方法时,session缓存会被清空</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>测试一级缓存</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Configuration configuration = <span class="keyword">new</span> Configuration().configure();</span><br><span class="line">       SessionFactory sessionFactory = configuration.buildSessionFactory();</span><br><span class="line">       Session session = sessionFactory.openSession();</span><br><span class="line">       Transaction transaction = session.beginTransaction();</span><br><span class="line">       Customer customer1 = session.get(Customer.class, <span class="number">2L</span>);</span><br><span class="line">       System.out.println(customer);</span><br><span class="line">       Customer customer2 = session.get(Customer.class, <span class="number">2L</span>);</span><br><span class="line">       System.out.println(customer1);</span><br><span class="line">       System.out.println(customer1 == customer2);</span><br><span class="line">       transaction.commit();</span><br><span class="line">       session.close();</span><br></pre></td></tr></table></figure>

<ul>
<li>控制台输出</li>
</ul>
<p><img src="/2019/07/10/Hibernate总结/1558077587353.png" alt="1558077587353"></p>
<ul>
<li>可以看到在第一次执行session的get()方法获取customer1对象时,由于一级缓存中没有数据,所以Hibernate会向数据库发送一条sql语句,查询id=2的对象,当再次调用session的get()方法获取customer2对象时,将不会再发送sql语句,这是因为customer2对象是从一级缓存中获取的.</li>
</ul>
</li>
</ul>
<h3 id="五-一级缓存的内部结构-快照区"><a href="#五-一级缓存的内部结构-快照区" class="headerlink" title="五.一级缓存的内部结构(快照区)"></a>五.一级缓存的内部结构(快照区)</h3><ul>
<li>Hibernate向一级缓存存放入数据时,同时复制一份数据放到Hibernate快照区,当使用commit()方法提交事务时,同时会清理Session的一级缓存,<strong>这时会使用OID判断一级缓存中的对象和快照中的对象是否一致,如果两个对象中的属性发生变化,则执行update语句,将缓存的内容同步到数据库,并更新快照,如果一致,则不执行update语句</strong>,Hibernate快照的作用就是确保一级缓存中的数据和数据库中的数据一致.</li>
</ul>
<p><img src="/2019/07/10/Hibernate总结/1558078245102.png" alt="1558078245102"></p>
<h3 id="六-Hibernate事务控制"><a href="#六-Hibernate事务控制" class="headerlink" title="六.Hibernate事务控制"></a>六.Hibernate事务控制</h3><ul>
<li><strong>事务的隔离级别</strong></li>
</ul>
<table>
<thead>
<tr>
<th>名称</th>
<th>级别</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>Read_Uncommited(读未提交)</td>
<td>1级</td>
<td>允许你读取还未提交的改变了的数据,可能导致脏,幻,不可重复读</td>
</tr>
<tr>
<td>Read_Committed(读已提交,oracle默认)</td>
<td>2级</td>
<td>允许在并发事务已经提交后读取,可防止脏读,但幻读和不可重复读仍可发生</td>
</tr>
<tr>
<td>Repeatable_read(可重复读,MySQL默认)</td>
<td>4级</td>
<td>对相同字段的多次读取是一致的,除非数据被事务本身改变,可防止脏,不可重复读,但幻读仍可以发生</td>
</tr>
<tr>
<td>Serializable(序列化/串行化)</td>
<td>8级</td>
<td>完全服从ACID的隔离级别,确保不发生脏,幻,不可重复读.这在所有的隔离级别中是最慢的,他是典型的通过完全锁定在事务中涉及的数据表来完成的</td>
</tr>
</tbody></table>
<ul>
<li><p><strong>Hibernate基于配置文件的事务管理</strong></p>
<ol>
<li>在hibernate.cfg.xml中配置</li>
</ol>
<ul>
<li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>1/2/4/8<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li><p>在dao层操作数据库需要用到session对象.在service控制事务也是使用session对象完成. 我们要确保dao层和service层使用的使用同一个session对象,如何解决.</p>
<ul>
<li><p>hibernate已经帮我们解决了,我们只需要调用<strong>==sessionFaction.getCurrentSession()==</strong>方法既可获得与当前线程绑定的session对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoSession</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        <span class="comment">//返回同一个与线程绑定的session</span></span><br><span class="line">        Session session1 = sessionFactory.getCurrentSession();</span><br><span class="line">        Session session2 = sessionFactory.getCurrentSession();</span><br><span class="line">        System.out.println(session1 == session2);</span><br><span class="line">        <span class="comment">//返回不同的session</span></span><br><span class="line">        Session session3 = sessionFactory.openSession();</span><br><span class="line">        Session session4 = sessionFactory.openSession();</span><br><span class="line">        System.out.println(session3 == session4);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">==注:调用getCurrentSession方法必须配合主配置中的一段配置(hibernate.cfg.xml)==</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"> <span class="comment">&lt;!--配置session绑定本地线程--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--thread:session对象的生命周期与本地线程绑定--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jta:session对象的生命周期与JTA事务绑定--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--managed:Hibernate委托程序来管理Session对象的生命周期--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="七-Hibernate中的批量查询"><a href="#七-Hibernate中的批量查询" class="headerlink" title="七.Hibernate中的批量查询"></a>七.Hibernate中的批量查询</h3><ol>
<li><p><strong>HQL查询-hibernate Query Language(多表查询,不复杂时使用)</strong></p>
<ul>
<li><p>Hibernate独家查询语言,属于面向对象的查询语言</p>
<ul>
<li><p>基本查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">       Session session = sessionFactory.openSession();</span><br><span class="line">       <span class="comment">//查询所有的Customer对象</span></span><br><span class="line">       Query customer = session.createQuery(<span class="string">"from Customer "</span>);</span><br><span class="line">       List list = customer.list();</span><br><span class="line">       System.out.println(list);</span><br></pre></td></tr></table></figure>
</li>
<li><p>条件查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * ?后面的参数要与setParameter的参数保持一致,不一定要从0开始,不写会报异常</span></span><br><span class="line"><span class="comment">         * org.hibernate.QueryException: Legacy-style query parameters (`?`)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//定义HQL语句创建查询对象</span></span><br><span class="line">        Query query = session.createQuery(<span class="string">" from Customer where cust_id = ?0 "</span>);</span><br><span class="line">        <span class="comment">//设置参数</span></span><br><span class="line">        query.setParameter(<span class="number">0</span>, <span class="number">1L</span>);</span><br><span class="line">        <span class="comment">//根据查询对象获取查询结果</span></span><br><span class="line">        Customer customer = (Customer) query.uniqueResult();</span><br><span class="line">        System.out.println(customer);</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>分页查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">page</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        <span class="comment">//定义HQL语句</span></span><br><span class="line">        String hql = <span class="string">"from Customer"</span>;</span><br><span class="line">        Query query = session.createQuery(hql);</span><br><span class="line">        <span class="comment">//设置分页信息limit ? ,?</span></span><br><span class="line">        <span class="comment">//起始页</span></span><br><span class="line">        query.setFirstResult(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//每页显示数</span></span><br><span class="line">        query.setMaxResults(<span class="number">2</span>);</span><br><span class="line">        List&lt;Customer&gt; list = query.list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Query中除了list()方法查询全部数据外,还有其他一些常用的方法</p>
<ul>
<li>setting()方法:Query接口中提供了一系列setting方法用于设置查询语句中的参数,针对不同的数据类型,需要用到不同的setting方法.</li>
<li>iterator()方法:该方法用于查询语句,返回的结果是一个Iterator对象,在读取时只能按照顺序方式读取,它仅把使用到的数据转换成java实体对象.</li>
<li>uniqueResult()方法:该方法用于返回唯一的结果,在确保只有一条记录的查询时可以使用该方法.</li>
<li>executeUpdate()方法:该方法是Hibernate3的新特性,它支持HQL语句的更新和删除操作.</li>
<li>setFirstResult()方法:该方法可以设置获取第一个记录的位置,也就是它表示从第几条记录开始查询,默认从0开始计算.</li>
<li>setMaxResult()方法:该方法用于设置结果集的最大记录数,通常与setFirstResult()方法结合使用,用于限制结果集的范围,以实现分页功能.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>Criteria查询(单表条件查询)</strong></p>
<ul>
<li>criteria是一个完全面向对象,可扩展的条件查询API,通过它完全不需要考虑数据库底层如何实现,以及sql语句如何编写,他是Hibernate框架的核心查询对象,Criteria查询,又称为QBC(Query by Criteria)查询,他是Hibernate的另一种对象检索方式.</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CriteriaDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CriteriaDemo cd = <span class="keyword">new</span> CriteriaDemo();</span><br><span class="line">        cd.findAll();</span><br><span class="line">        cd.findByName();</span><br><span class="line">        cd.findByPage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询全部</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">        List&lt;Customer&gt; list = criteria.list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据姓名查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">        criteria.add(Restrictions.eq(<span class="string">"cust_name"</span>,<span class="string">"alibaba"</span>));</span><br><span class="line">        List&lt;Customer&gt; list = criteria.list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findByPage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">        criteria.setFirstResult(<span class="number">0</span>);</span><br><span class="line">        criteria.setMaxResults(<span class="number">2</span>);</span><br><span class="line">        List&lt;Customer&gt; list = criteria.list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>原生SQL查询(复杂业务查询)</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SqlDemo sd = <span class="keyword">new</span> SqlDemo();</span><br><span class="line">    sd.findAll();</span><br><span class="line">    sd.findById();</span><br><span class="line">        sd.findpage();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询全部</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        String sql = <span class="string">"select * from cst_customer"</span>;</span><br><span class="line">        NativeQuery sqlQuery = session.createSQLQuery(sql);</span><br><span class="line">        sqlQuery.addEntity(Customer.class);</span><br><span class="line">        List&lt;Customer&gt; list = sqlQuery.list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        String sql = <span class="string">"select * from cst_customer where cust_id = ?0"</span>;</span><br><span class="line">        NativeQuery sqlQuery = session.createSQLQuery(sql);</span><br><span class="line">        sqlQuery.setParameter(<span class="number">0</span>,<span class="number">1L</span>);</span><br><span class="line">        sqlQuery.addEntity(Customer.class);</span><br><span class="line">        List&lt;Customer&gt; list = sqlQuery.list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findpage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        String sql = <span class="string">"select * from cst_customer limit ?0,?1 "</span>;</span><br><span class="line">        NativeQuery sqlQuery = session.createSQLQuery(sql);</span><br><span class="line">      sqlQuery.setParameter(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">      sqlQuery.setParameter(<span class="number">1</span>,<span class="number">1</span>);</span><br><span class="line">        sqlQuery.addEntity(Customer.class);</span><br><span class="line">        List&lt;Customer&gt; list = sqlQuery.list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="Hibernate-day03"><a href="#Hibernate-day03" class="headerlink" title="Hibernate day03"></a>Hibernate day03</h2><h3 id="一-Hibernate一对多关系映射"><a href="#一-Hibernate一对多关系映射" class="headerlink" title="一.Hibernate一对多关系映射"></a>一.Hibernate一对多关系映射</h3><ul>
<li><p><strong>创建实体类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"><span class="comment">//用于指定主键</span></span><br><span class="line"><span class="comment">//@Id</span></span><br><span class="line"><span class="comment">//    @OneToMany(targetEntity = LinkMan.class)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//用于指定主键的生成策略,GenerationType.IDENTITY为mysql默认的</span></span><br><span class="line"><span class="comment">//@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long cust_id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String cust_name;</span><br><span class="line">    <span class="keyword">private</span> String cust_source;</span><br><span class="line">    <span class="keyword">private</span> String cust_industry;</span><br><span class="line">    <span class="keyword">private</span> String cust_linkman;</span><br><span class="line">    <span class="keyword">private</span> String cust_level;</span><br><span class="line">    <span class="keyword">private</span> String cust_phone;</span><br><span class="line">    <span class="keyword">private</span> String cust_mobile;</span><br><span class="line">    <span class="comment">//一个客户有多个联系人,客户中应该放有联系人的集合</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Set&lt;LinkMan&gt; linkMans = <span class="keyword">new</span> HashSet&lt;LinkMan&gt;();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkMan</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long lkm_id;</span><br><span class="line">    <span class="keyword">private</span> Character lkm_gender;</span><br><span class="line">    <span class="keyword">private</span> String lkm_name;</span><br><span class="line">    <span class="keyword">private</span> String lkm_phone;</span><br><span class="line">    <span class="keyword">private</span> String lkm_email;</span><br><span class="line">    <span class="keyword">private</span> String lkm_qq;</span><br><span class="line">    <span class="keyword">private</span> String lkm_mobile;</span><br><span class="line">    <span class="keyword">private</span> String lkm_memo;</span><br><span class="line">    <span class="keyword">private</span> String lkm_position;</span><br><span class="line">    <span class="keyword">private</span> Customer customer;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>创建xml映射</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置表与实体对象的关系 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- package属性:填写一个包名.在元素内部凡是需要书写完整类名的属性,可以直接写简答类名了. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.ym.hibernate"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        class元素: 配置实体与表的对应关系的</span></span><br><span class="line"><span class="comment">            name: 完整类名</span></span><br><span class="line"><span class="comment">            table:数据库表名</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Customer"</span> <span class="attr">table</span>=<span class="string">"cst_customer"</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- id元素:配置主键映射的属性</span></span><br><span class="line"><span class="comment">                name: 填写主键对应属性名</span></span><br><span class="line"><span class="comment">                column(可选): 填写表中的主键列名.默认值:列名会默认使用属性名</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"cust_id"</span>  &gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- generator:主键生成策略 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--identity:主键自增,由数据库来维护主键值,录入时不需要指定主键--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--increment(线程不安全):主键自增,由hibernate来维护,每次插入前会先查询表中id最大值,+1作为新主键--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--sequence: Oracle中的主键生成策略--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--hilo(了解): 高低位算法.主键自增.由hibernate来维护.开发时不使用.--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--native:hilo+sequence+identity 自动三选一策略.--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--uuid: 产生随机字符串作为主键. 主键类型必须为string 类型.--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property元素:除id之外的普通属性映射</span></span><br><span class="line"><span class="comment">                name: 填写属性名</span></span><br><span class="line"><span class="comment">                column(可选): 填写列名</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_name"</span> <span class="attr">column</span>=<span class="string">"cust_name"</span> &gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  &lt;column name="cust_name" sql-type="varchar" &gt;&lt;/column&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_source"</span> <span class="attr">column</span>=<span class="string">"cust_source"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_industry"</span> <span class="attr">column</span>=<span class="string">"cust_industry"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_level"</span> <span class="attr">column</span>=<span class="string">"cust_level"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_linkman"</span> <span class="attr">column</span>=<span class="string">"cust_linkman"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_phone"</span> <span class="attr">column</span>=<span class="string">"cust_phone"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cust_mobile"</span> <span class="attr">column</span>=<span class="string">"cust_mobile"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--set标签:</span></span><br><span class="line"><span class="comment">                    name:多的一方的集合的属性名称--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMans"</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--key</span></span><br><span class="line"><span class="comment">                column:多的一方的外键名称--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--one-to-many</span></span><br><span class="line"><span class="comment">                    class多的一方的类全路径--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.ym.hibernate.LinkMan"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 配置表与实体对象的关系 --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- package属性:填写一个包名.在元素内部凡是需要书写完整类名的属性,可以直接写简答类名了. --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"com.ym.hibernate"</span> &gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        class元素: 配置实体与表的对应关系的</span></span><br><span class="line"><span class="comment">            name: 完整类名</span></span><br><span class="line"><span class="comment">            table:数据库表名</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"LinkMan"</span> <span class="attr">table</span>=<span class="string">"cst_linkman"</span> &gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- id元素:配置主键映射的属性</span></span><br><span class="line"><span class="comment">                name: 填写主键对应属性名</span></span><br><span class="line"><span class="comment">                column(可选): 填写表中的主键列名.默认值:列名会默认使用属性名</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"lkm_id"</span>  &gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- generator:主键生成策略 --&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--identity:主键自增,由数据库来维护主键值,录入时不需要指定主键--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--increment(线程不安全):主键自增,由hibernate来维护,每次插入前会先查询表中id最大值,+1作为新主键--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--sequence: Oracle中的主键生成策略--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--hilo(了解): 高低位算法.主键自增.由hibernate来维护.开发时不使用.--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--native:hilo+sequence+identity 自动三选一策略.--&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--uuid: 产生随机字符串作为主键. 主键类型必须为string 类型.--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- property元素:除id之外的普通属性映射</span></span><br><span class="line"><span class="comment">                name: 填写属性名</span></span><br><span class="line"><span class="comment">                column(可选): 填写列名</span></span><br><span class="line"><span class="comment">                type(可选):填写列(属性)的类型.hibernate会自动检测实体的属性类型.</span></span><br><span class="line"><span class="comment">                        每个类型有三种填法: java类型|hibernate类型|数据库类型</span></span><br><span class="line"><span class="comment">                not-null(可选):配置该属性(列)是否不能为空. 默认值:false</span></span><br><span class="line"><span class="comment">                length(可选):配置数据库中列的长度. 默认值:使用数据库类型的最大长度</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_gender"</span> <span class="attr">column</span>=<span class="string">"lkm_gender"</span> &gt;</span></span><br><span class="line">            <span class="comment">&lt;!--  &lt;column name="cust_name" sql-type="varchar" &gt;&lt;/column&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_name"</span> <span class="attr">column</span>=<span class="string">"lkm_name"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_phone"</span> <span class="attr">column</span>=<span class="string">"lkm_phone"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_email"</span> <span class="attr">column</span>=<span class="string">"lkm_email"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_qq"</span> <span class="attr">column</span>=<span class="string">"lkm_qq"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_mobile"</span> <span class="attr">column</span>=<span class="string">"lkm_mobile"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_memo"</span> <span class="attr">column</span>=<span class="string">"lkm_memo"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"lkm_position"</span> <span class="attr">column</span>=<span class="string">"lkm_position"</span> &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--many-to-one</span></span><br><span class="line"><span class="comment">            name:一的一方对象的名称</span></span><br><span class="line"><span class="comment">            class:一的一方的类的全路径</span></span><br><span class="line"><span class="comment">            column:表的外键名称--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">many-to-one</span> <span class="attr">name</span>=<span class="string">"customer"</span> <span class="attr">class</span>=<span class="string">"com.ym.hibernate.Customer"</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>将xml映射添加到配置文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version='1.0' encoding='utf-8'?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">        "-//Hibernate/Hibernate Configuration DTD//EN"</span></span><br><span class="line"><span class="meta">        "http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name="connection.url"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name="connection.driver_class"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name="connection.username"/&gt; --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;property name="connection.password"/&gt; --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- DB schema will be updated if needed --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库驱动  必须配置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库url 必须配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接用户名 必须配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接密码 必须配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 数据库方言  必须配置</span></span><br><span class="line"><span class="comment">            不同的数据库中,sql语法略有区别. 指定方言可以让hibernate框架在生成sql语句时.针对数据库的方言生成.</span></span><br><span class="line"><span class="comment">            sql99标准: DDL 定义语言  库表的增删改查</span></span><br><span class="line"><span class="comment">                      DCL 控制语言  事务 权限</span></span><br><span class="line"><span class="comment">                      DML 操纵语言  增删改查</span></span><br><span class="line"><span class="comment">            注意: MYSQL在选择方言时,请选择最短的方言.</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--不知道为啥必须写两个dialect数据库表才会创建成功--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;property name="dialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- #hibernate.show_sql true</span></span><br><span class="line"><span class="comment">             #hibernate.format_sql true</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 将hibernate生成的sql语句打印到控制台 可选配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 将hibernate生成的sql语句格式化(语法缩进) 可选配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        ## auto schema export  自动导出表结构. 自动建表    可选配置</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto create		自动建表.每次框架运行都会创建新的表.以前表将会被覆盖,表数据会丢失.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto create-drop 自动建表.每次框架运行结束都会将所有表删除.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto update(推荐使用) 自动生成表.如果已经存在不会再生成.如果表有变动.自动更新表(不会删除任何数据).</span></span><br><span class="line"><span class="comment">        #hibernate.hbm2ddl.auto validate	校验.不自动生成表.每次启动会校验数据库中表是否正确.校验失败.</span></span><br><span class="line"><span class="comment">         --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置session绑定本地线程--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--thread:session对象的生命周期与本地线程绑定--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--jta:session对象的生命周期与JTA事务绑定--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--managed:Hibernate委托程序来管理Session对象的生命周期--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当使用xml建立与实体类的映射时使用此配置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"./com/ym/hibernate/Customer.hbm.xml"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"./com/ym/hibernate/LinkMan.hbm.xml"</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;mapping class="com.ym.hibernate.Customer"/&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--当在实体类上使用注解时使用此配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnToMany</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setCust_name(<span class="string">"严"</span>);</span><br><span class="line">        LinkMan linkMan1 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">        linkMan1.setLkm_name(<span class="string">"李"</span>);</span><br><span class="line">        LinkMan linkMan2 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">        linkMan2.setLkm_name(<span class="string">"王"</span>);</span><br><span class="line">        customer.getLinkMans().add(linkMan1);</span><br><span class="line">        customer.getLinkMans().add(linkMan2);</span><br><span class="line">        linkMan1.setCustomer(customer);</span><br><span class="line">        linkMan2.setCustomer(customer);</span><br><span class="line">        session.save(customer);</span><br><span class="line">        session.save(linkMan1);</span><br><span class="line">        session.save(linkMan2);</span><br><span class="line">        transaction.commit();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在上面的代码中我们建立的关系是双向的,即客户关联了联系人,联系人也关联了客户,这就是双向关联,那么既然已经进行了双向的关联关系设置,那么我们还保存了双方,那如果我们只保存一方是否可以呢,这就需要使用级联操作</p>
</li>
<li><p><strong>级联操作是指当主控方执行保存,更新或者删除操作时,其关联对象(被控方)也执行相同的操作在映射文件中通过对cascade属性设置来控制是否对关联对象采用级联操作,级联操作对各种关系都是有效的</strong></p>
</li>
<li><p><strong>级联保存或更新</strong></p>
<ul>
<li><p>级联是有方向性的,所谓的方向性是指,在保存一的一方级联多的一方合在保存多的一方级联一的一方.</p>
</li>
<li><p>主控方:保存哪一方哪一方就是就是主控方,在主控方的xml中进行配置</p>
<p><img src="/2019/07/10/Hibernate总结/1558104622754.png" alt="1558104622754"></p>
</li>
<li><p>测试</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">       Session session = sessionFactory.openSession();</span><br><span class="line">       Transaction transaction = session.beginTransaction();</span><br><span class="line">       Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">       customer.setCust_name(<span class="string">"严"</span>);</span><br><span class="line">       LinkMan linkMan1 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">       linkMan1.setLkm_name(<span class="string">"李"</span>);</span><br><span class="line">       LinkMan linkMan2 = <span class="keyword">new</span> LinkMan();</span><br><span class="line">       linkMan2.setLkm_name(<span class="string">"王"</span>);</span><br><span class="line">       customer.getLinkMans().add(linkMan1);</span><br><span class="line">       customer.getLinkMans().add(linkMan2);</span><br><span class="line">       linkMan1.setCustomer(customer);</span><br><span class="line">       linkMan2.setCustomer(customer);</span><br><span class="line">       session.save(customer);</span><br><span class="line">       transaction.commit();</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>级联删除</strong></p>
<ul>
<li>设置cascade=”delete”</li>
<li>如果想有级联保存或更新,同时还想有级联删除配置如下</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cascade="delete,save-update"</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>双向关联产生多余sql语句</strong></p>
<ul>
<li>解决方案,让一的一方放弃外键的维护权</li>
<li>在一的一方的xml中配置</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--set标签:</span></span><br><span class="line"><span class="comment">                   name:多的一方的集合的属性名称--&gt;</span></span><br><span class="line">       <span class="comment">&lt;!--inverse为true表示放弃外键的维护权--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"linkMans"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span> <span class="attr">inverse</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--key</span></span><br><span class="line"><span class="comment">               column:多的一方的外键名称--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"lkm_cust_id"</span>&gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--one-to-many</span></span><br><span class="line"><span class="comment">                   class多的一方的类全路径--&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">one-to-many</span> <span class="attr">class</span>=<span class="string">"com.ym.hibernate.LinkMan"</span>/&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>cascade和inverse</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">//cascade和inverse</span></span><br><span class="line"><span class="comment">//cascade强调的是操作一个对象的时候,是否操作其关联对象</span></span><br><span class="line"><span class="comment">//inverse强调的是外键的维护权</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Session session = HibernateUtile.getCurrentSession();</span><br><span class="line">    Transaction transaction = session.beginTransaction();</span><br><span class="line">    Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">    customer.setCust_name(<span class="string">"王总"</span>);</span><br><span class="line">    LinkMan linkman = <span class="keyword">new</span> LinkMan();</span><br><span class="line">    linkman.setLkm_name(<span class="string">"李秘书"</span>);</span><br><span class="line">    <span class="comment">//在Customer.hbm.xml中的set上配置cascade="save-update" inverse="true"</span></span><br><span class="line">    customer.getLinkMans().add(linkMan);</span><br><span class="line">    session.save(customer);</span><br><span class="line">    transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/07/10/Hibernate总结/1558106423425.png" alt="1558106423425"></p>
</li>
</ul>
<h3 id="二-多对多关系映射"><a href="#二-多对多关系映射" class="headerlink" title="二.多对多关系映射"></a>二.多对多关系映射</h3><ul>
<li>创建实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * CREATE TABLE `sys_user` (</span></span><br><span class="line"><span class="comment">	  `user_id` bigint(32) NOT NULL AUTO_INCREMENT COMMENT '用户id',</span></span><br><span class="line"><span class="comment">	  `user_code` varchar(32) NOT NULL COMMENT '用户账号',</span></span><br><span class="line"><span class="comment">	  `user_name` varchar(64) NOT NULL COMMENT '用户名称',</span></span><br><span class="line"><span class="comment">	  `user_password` varchar(32) NOT NULL COMMENT '用户密码',</span></span><br><span class="line"><span class="comment">	  `user_state` char(1) NOT NULL COMMENT '1:正常,0:暂停',</span></span><br><span class="line"><span class="comment">	  PRIMARY KEY (`user_id`)</span></span><br><span class="line"><span class="comment">	) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="keyword">private</span> Long user_id;</span><br><span class="line">	<span class="keyword">private</span> String user_code;</span><br><span class="line">	<span class="keyword">private</span> String user_name;</span><br><span class="line">	<span class="keyword">private</span> String user_password;</span><br><span class="line">	<span class="keyword">private</span> Character user_state;</span><br><span class="line">	<span class="comment">//表达多对多</span></span><br><span class="line">	<span class="keyword">private</span> Set&lt;Role&gt; roles = <span class="keyword">new</span> HashSet&lt;Role&gt;();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Role</span> </span>&#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	  CREATE TABLE `sys_role` (</span></span><br><span class="line"><span class="comment">  `role_id` bigint(32) NOT NULL AUTO_INCREMENT,</span></span><br><span class="line"><span class="comment">  `role_name` varchar(32) NOT NULL COMMENT '角色名称',</span></span><br><span class="line"><span class="comment">  `role_memo` varchar(128) DEFAULT NULL COMMENT '备注',</span></span><br><span class="line"><span class="comment">  PRIMARY KEY (`role_id`)</span></span><br><span class="line"><span class="comment">) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8;</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">private</span> Long role_id;</span><br><span class="line">	<span class="keyword">private</span> String role_name;</span><br><span class="line">	<span class="keyword">private</span> String role_memo;</span><br><span class="line">	<span class="comment">//表达多对多</span></span><br><span class="line">	<span class="keyword">private</span> Set&lt;User&gt; users = <span class="keyword">new</span> HashSet&lt;User&gt;();</span><br></pre></td></tr></table></figure>

<ul>
<li><p>创建xml映射</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"cn.itcast.domain"</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"User"</span> <span class="attr">table</span>=<span class="string">"sys_user"</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"user_id"</span>  &gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_code"</span>  &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_name"</span>  &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_password"</span>  &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"user_state"</span>  &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- 多对多关系表达 --&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">			name: 集合属性名</span></span><br><span class="line"><span class="comment">			table: 配置中间表名</span></span><br><span class="line"><span class="comment">			key</span></span><br><span class="line"><span class="comment">			 |-column:外键,别人引用"我"的外键列名</span></span><br><span class="line"><span class="comment">			 class: 我与哪个类是多对多关系</span></span><br><span class="line"><span class="comment">			 column:外键.我引用比人的外键列名</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- cascade级联操作:</span></span><br><span class="line"><span class="comment">		 			save-update: 级联保存更新</span></span><br><span class="line"><span class="comment">		 			delete:级联删除</span></span><br><span class="line"><span class="comment">		 			all:级联保存更新+级联删除</span></span><br><span class="line"><span class="comment">		 	结论: cascade简化代码书写.该属性使不使用无所谓. 建议要用只用save-update.</span></span><br><span class="line"><span class="comment">		 		 如果使用delete操作太过危险.尤其在多对多中.不建议使用.</span></span><br><span class="line"><span class="comment">		 			 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"roles"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span> <span class="attr">cascade</span>=<span class="string">"save-update"</span> &gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"user_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"Role"</span> <span class="attr">column</span>=<span class="string">"role_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-mapping PUBLIC </span></span><br><span class="line"><span class="meta">    "-//Hibernate/Hibernate Mapping DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-mapping</span> <span class="attr">package</span>=<span class="string">"cn.itcast.domain"</span> &gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">class</span> <span class="attr">name</span>=<span class="string">"Role"</span> <span class="attr">table</span>=<span class="string">"sys_role"</span> &gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">name</span>=<span class="string">"role_id"</span>  &gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">generator</span> <span class="attr">class</span>=<span class="string">"native"</span>&gt;</span><span class="tag">&lt;/<span class="name">generator</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_name"</span>  &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"role_memo"</span>  &gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">&lt;!-- 使用inverse属性</span></span><br><span class="line"><span class="comment">			true: 放弃维护外键关系</span></span><br><span class="line"><span class="comment">			false(默认值):维护关系</span></span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">		结论: 将来在开发中,如果遇到多对多关系.一定要选择一方放弃维护关系.</span></span><br><span class="line"><span class="comment">			 一般谁来放弃要看业务方向. 例如录入员工时,需要为员工指定所属角色.</span></span><br><span class="line"><span class="comment">			 那么业务方向就是由员工维护角色. 角色不需要维护与员工关系.角色放弃维护</span></span><br><span class="line"><span class="comment">		 --&gt;</span>		</span><br><span class="line">		<span class="tag">&lt;<span class="name">set</span> <span class="attr">name</span>=<span class="string">"users"</span> <span class="attr">table</span>=<span class="string">"sys_user_role"</span> <span class="attr">inverse</span>=<span class="string">"true"</span> &gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">key</span> <span class="attr">column</span>=<span class="string">"role_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">key</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">many-to-many</span> <span class="attr">class</span>=<span class="string">"User"</span> <span class="attr">column</span>=<span class="string">"user_id"</span> &gt;</span><span class="tag">&lt;/<span class="name">many-to-many</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE hibernate-configuration PUBLIC</span></span><br><span class="line"><span class="meta">	"-//Hibernate/Hibernate Configuration DTD 3.0//EN"</span></span><br><span class="line"><span class="meta">	"http://www.hibernate.org/dtd/hibernate-configuration-3.0.dtd"&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hibernate-configuration</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">session-factory</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		#hibernate.dialect org.hibernate.dialect.MySQLDialect</span></span><br><span class="line"><span class="comment">		#hibernate.dialect org.hibernate.dialect.MySQLInnoDBDialect</span></span><br><span class="line"><span class="comment">		#hibernate.dialect org.hibernate.dialect.MySQLMyISAMDialect</span></span><br><span class="line"><span class="comment">		#hibernate.connection.driver_class com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment">		#hibernate.connection.url jdbc:mysql:///test</span></span><br><span class="line"><span class="comment">		#hibernate.connection.username gavin</span></span><br><span class="line"><span class="comment">		#hibernate.connection.password</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- 数据库驱动 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.driver_class"</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- 数据库url --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.url"</span>&gt;</span>jdbc:mysql:///hibernate_32<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- 数据库连接用户名 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.username"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- 数据库连接密码 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.password"</span>&gt;</span>1234<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 数据库方言</span></span><br><span class="line"><span class="comment">			不同的数据库中,sql语法略有区别. 指定方言可以让hibernate框架在生成sql语句时.针对数据库的方言生成.</span></span><br><span class="line"><span class="comment">			sql99标准: DDL 定义语言  库表的增删改查</span></span><br><span class="line"><span class="comment">					  DCL 控制语言  事务 权限</span></span><br><span class="line"><span class="comment">					  DML 操纵语言  增删改查</span></span><br><span class="line"><span class="comment">			注意: MYSQL在选择方言时,请选择最短的方言.</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.dialect"</span>&gt;</span>org.hibernate.dialect.MySQLDialect<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- #hibernate.show_sql true </span></span><br><span class="line"><span class="comment">			 #hibernate.format_sql true</span></span><br><span class="line"><span class="comment">		--&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 将hibernate生成的sql语句打印到控制台 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.show_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 将hibernate生成的sql语句格式化(语法缩进) --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.format_sql"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		## auto schema export  自动导出表结构. 自动建表</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto create		自动建表.每次框架运行都会创建新的表.以前表将会被覆盖,表数据会丢失.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto create-drop 自动建表.每次框架运行结束都会将所有表删除.(开发环境中测试使用)</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto update(推荐使用) 自动生成表.如果已经存在不会再生成.如果表有变动.自动更新表(不会删除任何数据).</span></span><br><span class="line"><span class="comment">		#hibernate.hbm2ddl.auto validate	校验.不自动生成表.每次启动会校验数据库中表是否正确.校验失败.</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.hbm2ddl.auto"</span>&gt;</span>update<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- 引入orm元数据</span></span><br><span class="line"><span class="comment">			路径书写: 填写src下的路径</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- 指定hibernate操作数据库时的隔离级别 </span></span><br><span class="line"><span class="comment">			#hibernate.connection.isolation 1|2|4|8		</span></span><br><span class="line"><span class="comment">			0001	1	读未提交</span></span><br><span class="line"><span class="comment">			0010	2	读已提交</span></span><br><span class="line"><span class="comment">			0100	4	可重复读</span></span><br><span class="line"><span class="comment">			1000	8	串行化</span></span><br><span class="line"><span class="comment">		 --&gt;</span></span><br><span class="line">		 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.connection.isolation"</span>&gt;</span>4<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		 <span class="comment">&lt;!-- 指定session与当前线程绑定 --&gt;</span></span><br><span class="line">		 <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"hibernate.current_session_context_class"</span>&gt;</span>thread<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">		 </span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/itcast/domain/Customer.hbm.xml"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/itcast/domain/LinkMan.hbm.xml"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/itcast/domain/Role.hbm.xml"</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">mapping</span> <span class="attr">resource</span>=<span class="string">"cn/itcast/domain/User.hbm.xml"</span> /&gt;</span></span><br><span class="line">		</span><br><span class="line">	<span class="tag">&lt;/<span class="name">session-factory</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">hibernate-configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//保存员工以及角色</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 获得session</span></span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		<span class="comment">//2 开启事务</span></span><br><span class="line">		Transaction tx = session.beginTransaction();</span><br><span class="line">		<span class="comment">//-------------------------------------------------</span></span><br><span class="line">		<span class="comment">//3操作</span></span><br><span class="line">		<span class="comment">//1&gt; 创建两个 User</span></span><br><span class="line">		User u1 = <span class="keyword">new</span> User();</span><br><span class="line">		u1.setUser_name(<span class="string">"郝强勇"</span>);</span><br><span class="line">		</span><br><span class="line">		User u2 = <span class="keyword">new</span> User();</span><br><span class="line">		u2.setUser_name(<span class="string">"金家德"</span>);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//2&gt; 创建两个 Role</span></span><br><span class="line">		Role r1 = <span class="keyword">new</span> Role();</span><br><span class="line">		r1.setRole_name(<span class="string">"保洁"</span>);</span><br><span class="line">		</span><br><span class="line">		Role r2 = <span class="keyword">new</span> Role();</span><br><span class="line">		r2.setRole_name(<span class="string">"保安"</span>);</span><br><span class="line">		<span class="comment">//3&gt; 用户表达关系</span></span><br><span class="line">		u1.getRoles().add(r1);</span><br><span class="line">		u1.getRoles().add(r2);</span><br><span class="line">		</span><br><span class="line">		u2.getRoles().add(r1);</span><br><span class="line">		u2.getRoles().add(r2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//4&gt; 角色表达关系</span></span><br><span class="line">		r1.getUsers().add(u1);</span><br><span class="line">		r1.getUsers().add(u2);</span><br><span class="line">		</span><br><span class="line">		r2.getUsers().add(u1);</span><br><span class="line">		r2.getUsers().add(u2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//5&gt; 调用Save方法一次保存</span></span><br><span class="line">		session.save(u1);</span><br><span class="line">		session.save(u2);</span><br><span class="line">		session.save(r1);</span><br><span class="line">		session.save(r2);</span><br><span class="line">		<span class="comment">//-------------------------------------------------</span></span><br><span class="line">		<span class="comment">//4提交事务</span></span><br><span class="line">		tx.commit();</span><br><span class="line">		<span class="comment">//5关闭资源</span></span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//为郝强勇新增一个角色</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun3</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 获得session</span></span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		<span class="comment">//2 开启事务</span></span><br><span class="line">		Transaction tx = session.beginTransaction();</span><br><span class="line">		<span class="comment">//-------------------------------------------------</span></span><br><span class="line">		<span class="comment">//3操作</span></span><br><span class="line">		<span class="comment">//1&gt; 获得郝强勇用户</span></span><br><span class="line">		User user = session.get(User.class, <span class="number">1l</span>);</span><br><span class="line">		<span class="comment">//2&gt; 创建公关角色</span></span><br><span class="line">		Role r = <span class="keyword">new</span> Role();</span><br><span class="line">		r.setRole_name(<span class="string">"男公关"</span>);</span><br><span class="line">		<span class="comment">//3&gt; 将角色添加到用户中</span></span><br><span class="line">		user.getRoles().add(r);</span><br><span class="line">		<span class="comment">//4&gt; 将角色转换为持久化</span></span><br><span class="line">		<span class="comment">//session.save(r);</span></span><br><span class="line">		<span class="comment">//-------------------------------------------------</span></span><br><span class="line">		<span class="comment">//4提交事务</span></span><br><span class="line">		tx.commit();</span><br><span class="line">		<span class="comment">//5关闭资源</span></span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="comment">//为郝强勇解除一个角色</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun4</span><span class="params">()</span></span>&#123;</span><br><span class="line">		<span class="comment">//1 获得session</span></span><br><span class="line">		Session session = HibernateUtils.openSession();</span><br><span class="line">		<span class="comment">//2 开启事务</span></span><br><span class="line">		Transaction tx = session.beginTransaction();</span><br><span class="line">		<span class="comment">//-------------------------------------------------</span></span><br><span class="line">		<span class="comment">//3操作</span></span><br><span class="line">		<span class="comment">//1&gt; 获得郝强勇用户</span></span><br><span class="line">		User user = session.get(User.class, <span class="number">1l</span>);</span><br><span class="line">		<span class="comment">//2&gt; 获得要操作的角色对象(保洁,保安)</span></span><br><span class="line">		Role r1 = session.get(Role.class, <span class="number">1l</span>);</span><br><span class="line">		Role r2 = session.get(Role.class, <span class="number">2l</span>);</span><br><span class="line">		<span class="comment">//3&gt; 将角色从用户的角色集合中移除</span></span><br><span class="line">		user.getRoles().remove(r1);</span><br><span class="line">		user.getRoles().remove(r2);</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//-------------------------------------------------</span></span><br><span class="line">		<span class="comment">//4提交事务</span></span><br><span class="line">		tx.commit();</span><br><span class="line">		<span class="comment">//5关闭资源</span></span><br><span class="line">		session.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在多对多的保存操作中,如果进行双向维护关系,就必须有一方放弃外键维护权,一般由被动方放弃,用户主动选择角色,角色是被选择的,所以一般角色要放弃外键维护权,但如果只进行单向维护关系,那么就不需要放弃外键维护权了.</p>
</li>
<li><p>级联更新保存,删除与一对多同理.</p>
</li>
</ul>
<h2 id="Hibernate-day04"><a href="#Hibernate-day04" class="headerlink" title="Hibernate-day04"></a>Hibernate-day04</h2><h3 id="一-Hibernate的检索方式"><a href="#一-Hibernate的检索方式" class="headerlink" title="一.Hibernate的检索方式"></a>一.Hibernate的检索方式</h3><ol>
<li><p><strong>Hibernate检索方式</strong></p>
<ul>
<li>对象图导航检索</li>
<li>OID检索</li>
<li>HQL检索</li>
<li>QBC检索</li>
<li>SQL检索</li>
</ul>
</li>
<li><p><strong>详解</strong></p>
<ul>
<li><p>对象图导航检索</p>
<p><code>对象图导航检索方式是根据已加载的对象,导航到他的关联对象,它利用类与类之间的关系来检索对象(如要查找一个联系人对应的客户,就可以由联系人对象自动导航到联系人所属的客户对象,前提必须在对象关系映射上配置了多对一的关系)</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 对象图导航检索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Object</span><span class="params">()</span>  </span>&#123;</span><br><span class="line">    SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">    Session session = sessionFactory.openSession();</span><br><span class="line">    Transaction transaction = session.beginTransaction();</span><br><span class="line">    LinkMan linkMan = session.get(LinkMan.class, <span class="number">4L</span>);</span><br><span class="line">    Customer customer = linkMan.getCustomer();</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">    transaction.commit();</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>OID检索方式</p>
<p><code>OID检索方式主要是指用Session的get(),load()方法加载某条记录对应的对象</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * OID检索</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Oid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">    Session session = sessionFactory.openSession();</span><br><span class="line">    Transaction transaction = session.beginTransaction();</span><br><span class="line">    Customer customer = session.get(Customer.class, <span class="number">2L</span>);</span><br><span class="line">    LinkMan linkMan = session.load(LinkMan.class, <span class="number">4L</span>);</span><br><span class="line">    System.out.println(customer);</span><br><span class="line">    System.out.println(linkMan);</span><br><span class="line">    transaction.commit();</span><br><span class="line">    session.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>HQL检索</p>
<p><code>HQL是面向对象的查询语言,它和sql查询语言有些相似,但它使用的是类,对象和属性的概念,而没有表和字段的概念,HQL是Hibernate推荐的查询语言,也是最广泛的一种检索方式,具有以下功能</code></p>
<ul>
<li><p>在查询语句中设定各种查询条件</p>
</li>
<li><p>支持投影查询,即仅检索出对象的部分属性</p>
</li>
<li><p>支持分页查询</p>
</li>
<li><p>支持分组查询,允许使用group by 和 having关键字</p>
</li>
<li><p>提供内置聚集函数,如sum(),min()和max()等</p>
</li>
<li><p>能够调用用户定义的SQL函数</p>
</li>
<li><p>支持子查询,即嵌套查询</p>
</li>
<li><p>支持动态绑定参数</p>
<p>Hibernate提供的Query接口是专门的HQL查询接口,他能执行各种复杂的HQL查询语句</p>
<p>由于Hibernate是面向对象的所以当我们在查询的时候需要写的是实体类的类名,而不是数据库表名(区分大小写)</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * HQL基本检索</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hql</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">       Session session = sessionFactory.openSession();</span><br><span class="line">       Transaction transaction = session.beginTransaction();</span><br><span class="line">       <span class="comment">//查询全部</span></span><br><span class="line">       String hql = <span class="string">"from Customer"</span>;</span><br><span class="line">       Query query = session.createQuery(hql);</span><br><span class="line">       List&lt;Customer&gt; list = query.list();</span><br><span class="line">       <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">           System.out.println(customer);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//排序查询</span></span><br><span class="line">       String hqlOrderBy = <span class="string">"from Customer order by cust_id desc"</span>;</span><br><span class="line">       Query query1 = session.createQuery(hqlOrderBy);</span><br><span class="line">       List&lt;Customer&gt; list1 = query1.list();</span><br><span class="line">       <span class="keyword">for</span> (Customer customer : list1) &#123;</span><br><span class="line">           System.out.println(customer);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//条件查询</span></span><br><span class="line">       String hqlWhereName = <span class="string">"from Customer where cust_name = ?0"</span>;</span><br><span class="line">       Query query2 = session.createQuery(hqlWhereName);</span><br><span class="line">       Query alibaba = query2.setParameter(<span class="number">0</span>, <span class="string">"alibaba"</span>);</span><br><span class="line">       List&lt;Customer&gt; list2 = alibaba.list();</span><br><span class="line">       <span class="keyword">for</span> (Customer customer : list2) &#123;</span><br><span class="line">       System.out.println(customer);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//分页检索</span></span><br><span class="line">       String limitHql = <span class="string">"from Customer order by cust_id desc "</span>;</span><br><span class="line">       Query query3 = session.createQuery(limitHql);</span><br><span class="line">       <span class="comment">//起始页</span></span><br><span class="line">      query3.setFirstResult(<span class="number">1</span>);</span><br><span class="line">      <span class="comment">//显示数量</span></span><br><span class="line">      query3.setMaxResults(<span class="number">2</span>);</span><br><span class="line">       List&lt;Customer&gt; list3 = query3.list();</span><br><span class="line">       <span class="keyword">for</span> (Customer customer : list3) &#123;</span><br><span class="line">           System.out.println(customer);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//统计查询</span></span><br><span class="line">       String CountHql = <span class="string">"select count(*) from Customer"</span>;</span><br><span class="line">       Query query4 = session.createQuery(CountHql);</span><br><span class="line">       Long num = (Long) query4.uniqueResult();</span><br><span class="line">       System.out.println(<span class="string">"共查询到"</span>+num);</span><br><span class="line">     </span><br><span class="line">       <span class="comment">//投影检索</span></span><br><span class="line">       <span class="comment">//投影查询一列</span></span><br><span class="line">       List&lt;String&gt; list4 = session.createQuery(<span class="string">"select cust_name from Customer"</span>).list();</span><br><span class="line">       <span class="keyword">for</span> (String s : list4) &#123;</span><br><span class="line">           System.out.println(s);</span><br><span class="line">       &#125;</span><br><span class="line">       transaction.commit();</span><br><span class="line">       session.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>QBC检索</p>
<p><code>QBC是Hibernte提供的另一种检索对象的方式,它主要由Criteria接口,Criterion接口和Expression接口类组成,Criteria接口是Hibernate API中的一个查询接口,他需要由session进行创建,Crterion是Criteria的查询条件,在Criteria中提供了add(Criterion criterion)方法来添加查询条件.</code></p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Qbc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">       Session session = sessionFactory.openSession();</span><br><span class="line">       Transaction transaction = session.beginTransaction();</span><br><span class="line">       Criteria criteria = session.createCriteria(Customer.class);</span><br><span class="line">       Criteria custId = criteria.add(Restrictions.eq(<span class="string">"cust_id"</span>, <span class="number">1L</span>));</span><br><span class="line">       List list = custId.list();</span><br><span class="line">       System.out.println(list);</span><br><span class="line">       transaction.commit();</span><br><span class="line">       session.close();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Restrictions类提供的方法</li>
</ul>
</li>
</ol>
<p><img src="/2019/07/10/Hibernate总结/1558162391908.png" alt="1558162391908"></p>
<ol start="3">
<li><p><strong>离线条件检索(DetachedCriteria)</strong></p>
<p>我们知道Criteria对象必须由session对象来创建,那么也就是说必须先有session才可以生成Criteria对象,而DetachedCriteria对象可以在其他层对条件进行封装</p>
<p>==优点==:在做一些特别复杂的条件查询的时候,往往会在web层向业务层传递很多的参数,业务层又会将这些参数传递给DAO层,最后在DAO中拼接SQL完成查询.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">DetachedCriteria</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获得一个离线条件查询的对象</span></span><br><span class="line">        DetachedCriteria detachedCriteria = DetachedCriteria.forClass(Customer.class);</span><br><span class="line">        detachedCriteria.add(Restrictions.eq(<span class="string">"cust_name"</span>,<span class="string">"alibaba"</span>));</span><br><span class="line">        SessionFactory sessionFactory = <span class="keyword">new</span> Configuration().configure().buildSessionFactory();</span><br><span class="line">        Session session = sessionFactory.openSession();</span><br><span class="line">        Transaction transaction = session.beginTransaction();</span><br><span class="line">        <span class="comment">//离线条件查询对象与session绑定</span></span><br><span class="line">        List&lt;Customer&gt; list = detachedCriteria.getExecutableCriteria(session).list();</span><br><span class="line">        <span class="keyword">for</span> (Customer customer : list) &#123;</span><br><span class="line">            System.out.println(customer);</span><br><span class="line">        &#125;</span><br><span class="line">        transaction.commit();</span><br><span class="line">        session.close();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="二-Hibernate多表查询"><a href="#二-Hibernate多表查询" class="headerlink" title="二.Hibernate多表查询"></a>二.Hibernate多表查询</h3><ul>
<li><h4 id="HQL连接查询"><a href="#HQL连接查询" class="headerlink" title="HQL连接查询"></a>HQL连接查询</h4><ul>
<li><p>HQL的多表连接查询的分类</p>
<ul>
<li>内连接<ul>
<li>显示内连接</li>
<li>隐式内连接</li>
<li>==迫切内连接==</li>
</ul>
</li>
<li>外连接<ul>
<li>左外连接</li>
<li>右外连接</li>
<li>==迫切左外连接==</li>
</ul>
</li>
</ul>
</li>
<li><p>SQL与HQL语句简单比较</p>
<ul>
<li><p>sql连接查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> cst_customer <span class="keyword">join</span> cst_linkman <span class="keyword">on</span> cst_customer.cust_id = cst_linkman.lkm_cust_id;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<ul>
<li><p>HQL连接查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from Customer join Customer.linkMans</span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="三-Hibernate抓取策略"><a href="#三-Hibernate抓取策略" class="headerlink" title="三.Hibernate抓取策略"></a>三.Hibernate抓取策略</h3><ul>
<li><p><strong>抓取策略</strong></p>
<ul>
<li><p>抓取策略是当应用程序需要在(Hibernate实体对象图的)关联关系间进行导航的时候,Hibernate如何获取关联对象的策略.</p>
</li>
<li><p>Hibernate的抓取策略是Hibernate提升性能的一种手段,可以在获取关联对象的时候,对发送的语句进行优化,往往抓取策略需要和延迟加载一起使用来提升性能.</p>
</li>
<li><p>抓取策略配置</p>
<p><img src="/2019/07/10/Hibernate总结/1558167014786.png" alt="1558167014786"></p>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><strong>延迟加载分类</strong></p>
<ul>
<li><p>延迟加载(lazy load)也称为懒加载,Hibernate关联关系对象默认的加载方式,延迟加载是为了避免一些无谓的性能开销而提出来的,所谓的延迟加载就是当在真正需要数据的时候,才真正执行数据加载操作.</p>
</li>
<li><p>通常将延迟加载分为两类.</p>
<ul>
<li><p>类级别延迟</p>
<ul>
<li>指的是查询某个对象的时候,是否采用有延迟,通常在<class>标签上配置lazy属性默认为true,表示延迟加载</class></li>
</ul>
</li>
<li><p>关联级别延迟</p>
<ul>
<li>指查询一个对象的关联对象的时候是否采用延迟加载,通常在<set>或<many-to-one>上配置lazy属性</many-to-one></set></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/2019/07/10/Hibernate总结/1558166823799.png" alt="1558166823799"></p>

        </div>
        
          


  <section class='meta' id="footer-meta">
    <hr>
    <div class='new-meta-box'>
      
        
          <div class="new-meta-item date" itemprop="dateUpdated" datetime="2019-07-10T01:23:36+08:00">
  <a class='notlink'>
    <i class="fas fa-clock" aria-hidden="true"></i>
    <p>最后更新于 Jul 10, 2019</p>
  </a>
</div>

        
      
        
          
  
  <div class="new-meta-item meta-tags"><a class="tag" href="/tags/java/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>java</p></a></div> <div class="new-meta-item meta-tags"><a class="tag" href="/tags/ORM/" rel="nofollow"><i class="fas fa-hashtag" aria-hidden="true"></i>&nbsp;<p>ORM</p></a></div>


        
      
        
          
  <div class="new-meta-item share -mob-share-list">
  <div class="-mob-share-list share-body">
    
      
        <a class="-mob-share-qq" title="QQ好友" rel="external nofollow noopener noreferrer"
          
          href="http://connect.qq.com/widget/shareqq/index.html?url=http://yoursite.com/2019/07/10/Hibernate总结/&title=Hibernate总结 | 编程是一门艺术&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qq.png">
          
        </a>
      
    
      
        <a class="-mob-share-qzone" title="QQ空间" rel="external nofollow noopener noreferrer"
          
          href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2019/07/10/Hibernate总结/&title=Hibernate总结 | 编程是一门艺术&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/qzone.png">
          
        </a>
      
    
      
        <a class="-mob-share-weibo" title="微博" rel="external nofollow noopener noreferrer"
          
          href="http://service.weibo.com/share/share.php?url=http://yoursite.com/2019/07/10/Hibernate总结/&title=Hibernate总结 | 编程是一门艺术&summary="
          
          >
          
            <img src="https://cdn.jsdelivr.net/gh/xaoxuu/assets@19.1.9/logo/128/weibo.png">
          
        </a>
      
    
  </div>
</div>



        
      
    </div>
  </section>


        
        
            <div class="prev-next">
                
                    <section class="prev">
                        <span class="art-item-left">
                            <h6><i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页</h6>
                            <h4>
                                <a href="/2019/07/11/MySQL常用函数/" rel="prev" title="MySQL常用函数">
                                  
                                      MySQL常用函数
                                  
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/MySQL/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>MySQL</a>
                                </h6>
                            
                        </span>
                    </section>
                
                
                    <section class="next">
                        <span class="art-item-right" aria-hidden="true">
                            <h6>下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i></h6>
                            <h4>
                                <a href="/2019/07/09/struts/" rel="prev" title="struts">
                                    
                                        struts
                                    
                                </a>
                            </h4>
                            
                                
                                <h6 class="tags">
                                    <a class="tag" href="/tags/java/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>java</a> <a class="tag" href="/tags/MVC/"><i class="fas fa-hashtag fa-fw" aria-hidden="true"></i>MVC</a>
                                </h6>
                            
                        </span>
                    </section>
                
            </div>
        
      </section>
    </article>
  

  
    <!-- 显示推荐文章和评论 -->



  


  




<!-- 根据页面mathjax变量决定是否加载MathJax数学公式js -->



  <script>
    window.subData = {
      title: 'Hibernate总结',
      tools: true
    }
  </script>


</div>
<aside class='l_side'>
  
    
    
      
        
          
          
            <section class='widget author'>
  <div class='content pure'>
    
    
    
  </div>
</section>

          
        
      
        
          
          
            
  <section class='widget toc-wrapper'>
    
<header class='pure'>
  <div><i class="fas fa-list fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;本文目录</div>
  
    <div class='wrapper'><a class="s-toc rightBtn" rel="external nofollow noopener noreferrer" href="javascript:void(0)"><i class="fas fa-thumbtack fa-fw"></i></a></div>
  
</header>

    <div class='content pure'>
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Hibernate笔记"><span class="toc-text">Hibernate笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#day01"><span class="toc-text">day01</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#入门"><span class="toc-text">入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-什么是Hibernate"><span class="toc-text">1. 什么是Hibernate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-优势"><span class="toc-text">2. 优势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-入门"><span class="toc-text">3.入门</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-首先看一下项目的整体目录结构"><span class="toc-text">1.首先看一下项目的整体目录结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-项目需要的jar包"><span class="toc-text">2.项目需要的jar包</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-创建实体类与数据库的映射关系-Customer-hbm-xml"><span class="toc-text">4.创建实体类与数据库的映射关系(Customer.hbm.xml)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-创建hibernate的核心配置文件-位于src根目录-hibernate-cfg-xml"><span class="toc-text">5.创建hibernate的核心配置文件,位于src根目录(hibernate.cfg.xml)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-测试类"><span class="toc-text">6.测试类</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-常用API"><span class="toc-text">4.常用API</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-Configuration"><span class="toc-text">1. Configuration</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-SessionFactory"><span class="toc-text">2.SessionFactory</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-session"><span class="toc-text">3.session</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4-Transaction"><span class="toc-text">4.Transaction</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hibernate-day02"><span class="toc-text">Hibernate day02</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一-Hibernate实体类注意事项"><span class="toc-text">一.Hibernate实体类注意事项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-主键生成策略"><span class="toc-text">二.主键生成策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三-对象状态"><span class="toc-text">三.对象状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#四-Hibernate的缓存"><span class="toc-text">四.Hibernate的缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#Hibernate的一级缓存"><span class="toc-text">Hibernate的一级缓存</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#五-一级缓存的内部结构-快照区"><span class="toc-text">五.一级缓存的内部结构(快照区)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#六-Hibernate事务控制"><span class="toc-text">六.Hibernate事务控制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#七-Hibernate中的批量查询"><span class="toc-text">七.Hibernate中的批量查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hibernate-day03"><span class="toc-text">Hibernate day03</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一-Hibernate一对多关系映射"><span class="toc-text">一.Hibernate一对多关系映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-多对多关系映射"><span class="toc-text">二.多对多关系映射</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hibernate-day04"><span class="toc-text">Hibernate-day04</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一-Hibernate的检索方式"><span class="toc-text">一.Hibernate的检索方式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#二-Hibernate多表查询"><span class="toc-text">二.Hibernate多表查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HQL连接查询"><span class="toc-text">HQL连接查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#三-Hibernate抓取策略"><span class="toc-text">三.Hibernate抓取策略</span></a></li></ol></li></ol>
    </div>
  </section>


          
        
      
        
          
          
            <section class='widget grid'>
  
<header class='pure'>
  <div><i class="fas fa-map-signs fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;站内导航</div>
  
</header>

  <div class='content pure'>
    <ul class="grid navgation">
      
        <li><a class="flat-box" title="/" href="/"
          
          
          id="home">
          
            <i class="fas fa-clock fa-fw" aria-hidden="true"></i>
          
          近期文章
        </a></li>
      
        <li><a class="flat-box" title="https://github.com/YanMao186" href="https://github.com/YanMao186"
          
          
          id="https:github.comYanMao186">
          
            <i class="fab fa-github fa-fw" aria-hidden="true"></i>
          
          github
        </a></li>
      
        <li><a class="flat-box" title="/about/" href="/about/"
          
            rel="nofollow"
          
          
          id="about">
          
            <i class="fas fa-info-circle fa-fw" aria-hidden="true"></i>
          
          关于小站
        </a></li>
      
    </ul>
  </div>
</section>

          
        
      
        
          
          
            
  <section class='widget category'>
    
<header class='pure'>
  <div><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;文章分类</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/blog/categories/"
    title="blog/categories/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content pure'>
      <ul class="entry">
        
          <li><a class="flat-box" title="/categories/HTTP-TCP-IP/" href="/categories/HTTP-TCP-IP/"><div class='name'>HTTP/TCP/IP</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box" title="/categories/MySQL/" href="/categories/MySQL/"><div class='name'>MySQL</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box" title="/categories/java/" href="/categories/java/"><div class='name'>java</div><div class='badge'>(18)</div></a></li>
        
      </ul>
    </div>
  </section>


          
        
      
        
          
          
            
  <section class='widget tagcloud'>
    
<header class='pure'>
  <div><i class="fas fa-fire fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;热门标签</div>
  
    <a class="rightBtn"
    
      rel="nofollow"
    
    
    href="/blog/tags/"
    title="blog/tags/">
    <i class="fas fa-expand-arrows-alt fa-fw"></i></a>
  
</header>

    <div class='content pure'>
      <a href="/tags/java-并发/" style="font-size: 14px; color: #999">-java -并发</a> <a href="/tags/Http/" style="font-size: 14px; color: #999">Http</a> <a href="/tags/I-O/" style="font-size: 14px; color: #999">I/O</a> <a href="/tags/IO/" style="font-size: 14px; color: #999">IO</a> <a href="/tags/MVC/" style="font-size: 14px; color: #999">MVC</a> <a href="/tags/MySQL/" style="font-size: 14px; color: #999">MySQL</a> <a href="/tags/ORM/" style="font-size: 14px; color: #999">ORM</a> <a href="/tags/Spring-Cloud/" style="font-size: 14px; color: #999">Spring Cloud</a> <a href="/tags/java/" style="font-size: 24px; color: #555">java</a> <a href="/tags/java编程思想/" style="font-size: 19px; color: #777">java编程思想</a> <a href="/tags/jvm/" style="font-size: 21.5px; color: #666">jvm</a> <a href="/tags/mysql/" style="font-size: 14px; color: #999">mysql</a> <a href="/tags/tcp-ip/" style="font-size: 14px; color: #999">tcp/ip</a> <a href="/tags/多线程/" style="font-size: 19px; color: #777">多线程</a> <a href="/tags/容器/" style="font-size: 14px; color: #999">容器</a> <a href="/tags/微服务/" style="font-size: 14px; color: #999">微服务</a> <a href="/tags/读书笔记/" style="font-size: 14px; color: #999">读书笔记</a> <a href="/tags/集合/" style="font-size: 14px; color: #999">集合</a> <a href="/tags/面向对象/" style="font-size: 16.5px; color: #888">面向对象</a>
    </div>
  </section>


          
        
      
        
          
          
            


  <section class='widget music'>
    
<header class='pure'>
  <div><i class="fas fa-compact-disc fa-fw" aria-hidden="true"></i>&nbsp;&nbsp;最近在听</div>
  
    <a class="rightBtn"
    
      rel="external nofollow noopener noreferrer"
    
    
      target="_blank"
    
    href="http://music.163.com/playlist?id=2758693024&userid=76931878"
    title="http://music.163.com/playlist?id=2758693024&userid=76931878">
    <i class="far fa-heart fa-fw"></i></a>
  
</header>

    <div class='content pure'>
      
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.css">
  <div class="aplayer"
    data-theme="#1BCDFC"
    
    
    data-mode="circulation"
    data-server="netease"
    data-type="playlist"
    data-id="2758693024"
    data-volume="0.5">
  </div>
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.7.0/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.1.0/dist/Meting.min.js"></script>


    </div>
  </section>


          
        
      
    

  
</aside>

<footer id="footer" class="clearfix">
  
  
  <br>
  <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
  <div>
    本站使用
    <a href="" target="_blank" class="codename">Hello World</a>
    作为主题
    
      ，
      总访问量为
      <span id="busuanzi_value_site_pv"><i class="fas fa-spinner fa-spin fa-fw" aria-hidden="true"></i></span>
      次
    
    。
  </div>
</footer>
<script>setLoadingBarProgress(80);</script>
<span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
<script>
    var now = new Date(); 
    function createtime() { 
        var grt= new Date("03/16/2019 23:30:00");//在此处修改你的建站时间
        now.setTime(now.getTime()+250); 
        days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
        hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
        if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
        mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
        seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
        snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
        document.getElementById("timeDate").innerHTML = "本站已安全运行 "+dnum+" 天 "; 
        document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
    } 
setInterval("createtime()",250);
</script>



      <script>setLoadingBarProgress(60);</script>
    </div>
    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>

<script src="//instant.page/1.2.2" type="module" integrity="sha384-2xV8M5griQmzyiY3CDqh1dn4z3llDVqZDqzjzcY+jCBCk/a5fXJmuZ/40JJAPeoU"></script>


  <script async src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.5/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    $(function() {
      const $reveal = $('.reveal');
      if ($reveal.length === 0) return;
      const sr = ScrollReveal({ distance: 0 });
      sr.reveal('.reveal');
    });
  </script>


  <script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>
  <script type="text/javascript">
    $(function() {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>


  <script async src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js"></script>




  
  
  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
    <script type="text/javascript">
      $(function(){
        if ('.cover') {
          $('.cover').backstretch(
          [""],
          {
            duration: "6000",
            fade: "2500"
          });
        } else {
          $.backstretch(
          [""],
          {
            duration: "6000",
            fade: "2500"
          });
        }
      });
    </script>
  











  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/app.js"></script>


  <script src="https://cdn.jsdelivr.net/gh/xaoxuu/cdn-material-x@19.5/js/search.js"></script>




<!-- 复制 -->
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  let COPY_SUCCESS = "复制成功";
  let COPY_FAILURE = "复制失败";
  /*页面载入完成后，创建复制按钮*/
  !function (e, t, a) {
    /* code */
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '  <i class="fa fa-copy"></i><span>复制</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });

      clipboard.on('success', function(e) {
        //您可以加入成功提示
        console.info('Action:', e.action);
        console.info('Text:', e.text);
        console.info('Trigger:', e.trigger);
        success_prompt(COPY_SUCCESS);
        e.clearSelection();
      });
      clipboard.on('error', function(e) {
        //您可以加入失败提示
        console.error('Action:', e.action);
        console.error('Trigger:', e.trigger);
        fail_prompt(COPY_FAILURE);
      });
    }
    initCopyCode();

  }(window, document);

  /**
   * 弹出式提示框，默认1.5秒自动消失
   * @param message 提示信息
   * @param style 提示样式，有alert-success、alert-danger、alert-warning、alert-info
   * @param time 消失时间
   */
  var prompt = function (message, style, time)
  {
      style = (style === undefined) ? 'alert-success' : style;
      time = (time === undefined) ? 1500 : time*1000;
      $('<div>')
          .appendTo('body')
          .addClass('alert ' + style)
          .html(message)
          .show()
          .delay(time)
          .fadeOut();
  };

  // 成功提示
  var success_prompt = function(message, time)
  {
      prompt(message, 'alert-success', time);
  };

  // 失败提示
  var fail_prompt = function(message, time)
  {
      prompt(message, 'alert-danger', time);
  };

  // 提醒
  var warning_prompt = function(message, time)
  {
      prompt(message, 'alert-warning', time);
  };

  // 信息提示
  var info_prompt = function(message, time)
  {
      prompt(message, 'alert-info', time);
  };

</script>


<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  let LAZY_LOAD_IMAGE = "";
  $(".article-entry").find("fancybox").find("img").each(function () {
      var element = document.createElement("a");
      $(element).attr("data-fancybox", "gallery");
      $(element).attr("href", $(this).attr("src"));
      /* 图片采用懒加载处理时,
       * 一般图片标签内会有个属性名来存放图片的真实地址，比如 data-original,
       * 那么此处将原本的属性名src替换为对应属性名data-original,
       * 修改如下
       */
       if (LAZY_LOAD_IMAGE) {
         $(element).attr("href", $(this).attr("data-original"));
       }
      $(this).wrap(element);
  });
</script>





  <script>setLoadingBarProgress(100);</script>
 

<script type="text/javascript"
color="220,220,220" opacity='0.7' zIndex="-2" count="200" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js">
</script>
<!--浏览器搞笑标题-->
<script type="text/javascript" src="\js\FunnyTitle.js"></script>
<!-- 数字雨 -->
<canvas id="canvas" width="1440" height="900" ></canvas>
<script type="text/javascript">

		
		window.onload = function(){
			//获取画布对象
			var canvas = document.getElementById("canvas");
			//获取画布的上下文
			var context =canvas.getContext("2d");
			  var s = window.screen;
             var W = canvas.width = s.width;
             var H = canvas.height;
			//获取浏览器屏幕的宽度和高度
			//var W = window.innerWidth;
			//var H = window.innerHeight;
			//设置canvas的宽度和高度
			canvas.width = W;
			canvas.height = H;
			//每个文字的字体大小
			var fontSize = 16;
			//计算列
			var colunms = Math.floor(W /fontSize);	
			//记录每列文字的y轴坐标
			var drops = [];
			//给每一个文字初始化一个起始点的位置
			for(var i=0;i<colunms;i++){
				drops.push(0);
			}

			//运动的文字
			var str ="javascript html5 canvas  严茂 www.mryanmao.top";
			//4:fillText(str,x,y);原理就是去更改y的坐标位置
			//绘画的函数
			function draw(){
				context.fillStyle = "rgba(0,0,0,.08)";//遮盖层
				context.fillRect(0,0,W,H);
				//给字体设置样式
				context.font = "700 "+fontSize+"px  微软雅黑";
				//给字体添加颜色
				context.fillStyle = "green";//randColor();可以rgb,hsl, 标准色，十六进制颜色
				//写入画布中
				for(var i=0;i<colunms;i++){
					var index = Math.floor(Math.random() * str.length);
					var x = i*fontSize;
					var y = drops[i] *fontSize;
					context.fillText(str[index],x,y);
					//如果要改变时间，肯定就是改变每次他的起点
					if(y >= canvas.height && Math.random() > 0.99){
						drops[i] = 0;
					}
					drops[i]++;
				}
			};

			function randColor(){//随机颜色
				var r = Math.floor(Math.random() * 256);
				var g = Math.floor(Math.random() * 256);
				var b = Math.floor(Math.random() * 256);
				return "rgb("+r+","+g+","+b+")";
			}

			draw();
			setInterval(draw,30);
		};

	
</script>
</body>
</html>
